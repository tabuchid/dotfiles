"use strict";var W=Object.create;var b=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var n in t)b(e,n,{get:t[n],enumerable:!0})},T=(e,t,n,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of z(t))!j.call(e,l)&&l!==n&&b(e,l,{get:()=>t[l],enumerable:!(c=V(t,l))||c.enumerable});return e};var R=(e,t,n)=>(n=e!=null?W(N(e)):{},T(t||!e||!e.__esModule?b(n,"default",{value:e,enumerable:!0}):n,e)),G=e=>T(b({},"__esModule",{value:!0}),e);var ee={};B(ee,{default:()=>X});module.exports=G(ee);var r=require("@raycast/api"),v=require("react");var i=require("@raycast/api");var d=R(require("react")),o=require("@raycast/api");var P=require("react/jsx-runtime");var f=require("fs");var k=require("path"),U=require("child_process"),I=require("os");var w=R(require("node:os"),1),m,y;function g(e){if(typeof e!="string")throw new TypeError(`Expected a string, got ${typeof e}`);if(m===void 0&&(m=w.default.homedir()),m&&/^~(?=$|\/|\\)/.test(e))return e.replace(/^~/,m);let t=e.match(/^~([^/\\]+)(.*)/);if(t&&(y===void 0&&(y=w.default.userInfo().username),y)){let n=t[1],c=t[2];if(n===y)return m+c}return e}var u=require("react/jsx-runtime"),C=new i.Cache,_="customDownloadsFolder",h=(0,i.getPreferenceValues)();function K(){if(h.downloadsFolder&&h.downloadsFolder.trim())return g(h.downloadsFolder);let e=C.get(_);if(e&&typeof e=="string")return e;let t=q();return C.set(_,t),t}var p=K(),H=h.showHiddenFiles,J=h.fileOrder,ue=h.lastestDownloadOrder,O=h.downloadsLayout??"list",Z=[".png",".jpg",".jpeg",".gif",".webp",".bmp",".tiff",".heic",".svg"];function q(){if(process.platform==="darwin")return g("~/Downloads");if(process.platform==="win32")try{return(0,U.execSync)(`powershell -Command "(New-Object -ComObject Shell.Application).NameSpace('shell:Downloads').Self.Path"`,{encoding:"utf-8"}).trim()}catch(e){return console.error("Failed to get Downloads folder from registry:",e),(0,k.join)((0,I.homedir)(),"Downloads")}return g("~/Downloads")}function D(e){let t=e.lastIndexOf(".");if(t===-1)return!1;let n=e.toLowerCase().slice(t);return Z.includes(n)}function x(){return(0,f.readdirSync)(p).filter(t=>H||!t.startsWith(".")).map(t=>{let n=(0,k.join)(p,t);try{let c=(0,f.statSync)(n);return{file:t,path:n,lastModifiedAt:c.mtime,createdAt:c.ctime,addedAt:c.atime,birthAt:c.birthtime}}catch(c){console.warn(`Skipping '${n}' because it could not be stat'd:`,c);return}}).filter(t=>!!t).map(t=>t).sort((t,n)=>{switch(J){case"addTime":return n.addedAt.getTime()-t.addedAt.getTime();case"createTime":return n.createdAt.getTime()-t.createdAt.getTime();case"modifiedTime":default:return n.lastModifiedAt.getTime()-t.lastModifiedAt.getTime()}})}function Y(){try{return(0,f.accessSync)(p,f.constants.R_OK),!0}catch(e){return console.error(e),!1}}var L=e=>t=>{if(Y())return(0,u.jsx)(e,{...t});if(process.platform==="darwin")return(0,u.jsx)(i.Detail,{markdown:`## Permission Required

The Downloads Manager extension requires access to your Downloads folder. Please grant permission to use it.

![Grant Permission](permission.png)`,actions:(0,u.jsx)(i.ActionPanel,{children:(0,u.jsx)(i.Action.Open,{title:"Grant Permission",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"})})});{let n=`## Cannot Access Downloads Folder

Unable to access the Downloads folder at:
\`${p}\`

Please check that the folder exists and the path is correct.`;return(0,u.jsx)(i.Detail,{markdown:n,actions:(0,u.jsx)(i.ActionPanel,{children:(0,u.jsx)(i.Action.ShowInFinder,{path:p})})})}};var s=require("react/jsx-runtime");function Q(){let[e,t]=(0,v.useState)(x()),[n,c]=(0,v.useState)(O);function l(a){t($=>$.filter(E=>Array.isArray(a)?!a.includes(E.path):a!==E.path))}function M(){t(x())}let F=a=>(0,s.jsxs)(r.ActionPanel,{children:[(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.Open,{title:"Open File",target:a.path}),(0,s.jsx)(r.Action.ShowInFinder,{path:a.path}),(0,s.jsx)(r.Action.CopyToClipboard,{title:"Copy File",content:{file:a.path},shortcut:r.Keyboard.Shortcut.Common.Copy}),(0,s.jsx)(r.Action,{title:"Reload Downloads",icon:r.Icon.RotateAntiClockwise,shortcut:r.Keyboard.Shortcut.Common.Refresh,onAction:M})]}),(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.OpenWith,{path:a.path,shortcut:r.Keyboard.Shortcut.Common.OpenWith}),(0,s.jsx)(r.Action.ToggleQuickLook,{shortcut:r.Keyboard.Shortcut.Common.ToggleQuickLook}),(0,s.jsx)(r.Action,{title:"Toggle Layout",icon:n==="list"?r.Icon.AppWindowGrid3x3:r.Icon.AppWindowList,shortcut:{macOS:{modifiers:["cmd"],key:"l"},Windows:{modifiers:["ctrl"],key:"l"}},onAction:()=>c(n==="list"?"grid":"list")})]}),(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.Trash,{title:"Delete Download",paths:a.path,shortcut:r.Keyboard.Shortcut.Common.Remove,onTrash:l}),(0,s.jsx)(r.Action.Trash,{title:"Delete All Downloads",paths:e.map($=>$.path),shortcut:r.Keyboard.Shortcut.Common.RemoveAll,onTrash:l})]})]}),S={icon:{fileIcon:p},title:"No downloads found",description:"Well, first download some files \xAF\\_(\u30C4)_/\xAF"},A=a=>({title:a.file,quickLook:{path:a.path,name:a.file},actions:F(a)});return n==="grid"?(0,s.jsxs)(r.Grid,{columns:8,children:[e.length===0&&(0,s.jsx)(r.Grid.EmptyView,{...S}),e.map(a=>(0,s.jsx)(r.Grid.Item,{...A(a),content:D(a.file)?{source:a.path}:{fileIcon:a.path}},a.path))]}):(0,s.jsxs)(r.List,{children:[e.length===0&&(0,s.jsx)(r.List.EmptyView,{...S}),e.map(a=>(0,s.jsx)(r.List.Item,{...A(a),icon:{fileIcon:a.path},accessories:[{date:a.lastModifiedAt,tooltip:`Last modified: ${a.lastModifiedAt.toLocaleString()}`}]},a.path))]})}var X=L(Q);
