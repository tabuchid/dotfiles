"use strict";var p=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var $=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},T=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P(t))!x.call(e,o)&&o!==n&&p(e,o,{get:()=>t[o],enumerable:!(s=F(t,o))||s.enumerable});return e};var D=e=>T(p({},"__esModule",{value:!0}),e);var I={};$(I,{default:()=>g});module.exports=D(I);var r=require("@raycast/api");var a=require("@raycast/api"),S=(0,a.getPreferenceValues)().accessToken,c={Authorization:"Bearer "+S},R=Object.entries(c),h="https://api.vercel.com/";async function l(){try{return(await(await fetch(h+"www/user",{method:"get",headers:c})).json()).user}catch(e){throw console.error(e),(0,a.showToast)({style:a.Toast.Style.Failure,title:"Failed to fetch user info"}),new Error("Failed to fetch user info")}}async function u(){let t=await(await fetch(h+"v1/teams",{method:"get",headers:c})).json(),n=[];for(let s of t.teams)n.push(s);return n}function U(e,t,n=100){let s=h+"v6/deployments",o=`?limit=${n}&teamId=${e??""}`;return t&&(o+=`&projectId=${t}`),s+o}async function y(e){try{let t=U(e,void 0,1);return(await(await fetch(t,{method:"get",headers:c})).json()).deployments[0]??null}catch(t){throw console.error(t),(0,a.showToast)({style:a.Toast.Style.Failure,title:"Failed to fetch latest deployment"}),new Error("Failed to fetch latest deployment")}}function f(e,t,n){return n.startsWith("dpl_")&&(n=n.substring(4)),`https://vercel.com/${e}/${t}/${n}`}var V=async()=>{if(!await l())throw new Error("Failed to fetch user data. Token may be invalid.");return!0},v=V;async function g(){let e=await(0,r.showToast)({style:r.Toast.Style.Animated,title:"Loading latest deployment..."});try{await v()}catch{e.style=r.Toast.Style.Failure,e.title="Invalid token",e.message="Please set a valid Vercel access token in the settings.",e.primaryAction={title:"Open Settings",onAction:()=>(0,r.openCommandPreferences)()};return}let t=await r.LocalStorage.getItem("selectedTeamId"),[n,s]=await Promise.all([l(),u()]),o=t;t&&(s.some(d=>d.id===t)||(await r.LocalStorage.removeItem("selectedTeamId"),o=void 0));let i=await y(o);if(!i){e.style=r.Toast.Style.Failure,e.title="No deployments found",e.message=o?"No deployments found for the selected team.":"No deployments found.";return}let w=(0,r.getPreferenceValues)().openTarget??"vercel",m;if(w==="deployUrl")m=`https://${i.url}`;else{let d=(o?s.find(E=>E.id===o):void 0)?.slug||n.username,b=i.id||i.uid;m=f(d,i.name,b)}e.style=r.Toast.Style.Success,e.title="Opening deployment",e.message=i.name,await(0,r.open)(m)}
