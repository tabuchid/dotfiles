"use strict";var ue=Object.create;var W=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var me=(r,n)=>{for(var t in n)W(r,t,{get:n[t],enumerable:!0})},K=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of de(n))!pe.call(r,a)&&a!==t&&W(r,a,{get:()=>n[a],enumerable:!(e=fe(n,a))||e.enumerable});return r};var N=(r,n,t)=>(t=r!=null?ue(he(r)):{},K(n||!r||!r.__esModule?W(t,"default",{value:r,enumerable:!0}):t,r)),be=r=>K(W({},"__esModule",{value:!0}),r);var Oe={};me(Oe,{default:()=>oe});module.exports=be(Oe);var k=require("@raycast/api");var i=N(require("react")),l=require("@raycast/api");var H=Object.prototype.hasOwnProperty;function j(r,n){var t,e;if(r===n)return!0;if(r&&n&&(t=r.constructor)===n.constructor){if(t===Date)return r.getTime()===n.getTime();if(t===RegExp)return r.toString()===n.toString();if(t===Array){if((e=r.length)===n.length)for(;e--&&j(r[e],n[e]););return e===-1}if(!t||typeof r=="object"){e=0;for(t in r)if(H.call(r,t)&&++e&&!H.call(n,t)||!(t in n)||!j(r[t],n[t]))return!1;return Object.keys(n).length===e}}return r!==r&&n!==n}var I=N(require("node:fs")),B=N(require("node:path")),Y=N(require("node:crypto"));var X=require("react/jsx-runtime");var Q=require("node:url");function ge(r){let n=(0,i.useRef)(r),t=(0,i.useRef)(0);return j(r,n.current)||(n.current=r,t.current+=1),(0,i.useMemo)(()=>n.current,[t.current])}function w(r){let n=(0,i.useRef)(r);return n.current=r,n}function $e(r,n){let t=r instanceof Error?r.message:String(r);return(0,l.showToast)({style:l.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??t,primaryAction:n?.primaryAction??J(r),secondaryAction:n?.primaryAction?J(r):void 0})}var J=r=>{let n=!0,t="[Extension Name]...",e="";try{let s=JSON.parse((0,I.readFileSync)((0,B.join)(l.environment.assetsPath,"..","package.json"),"utf8"));t=`[${s.title}]...`,e=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(n=!1)}catch{}let a=l.environment.isDevelopment||n,o=r instanceof Error?r?.stack||r?.message||"":String(r);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?l.Clipboard.copy(o):(0,l.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(e)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${o}
\`\`\`
`)}`)}}};function ye(r,n,t){let e=(0,i.useRef)(0),[a,o]=(0,i.useState)({isLoading:!0}),s=w(r),u=w(t?.abortable),c=w(n||[]),m=w(t?.onError),p=w(t?.onData),b=w(t?.onWillExecute),v=w(t?.failureToastOptions),S=w(a.data),y=(0,i.useRef)(null),d=(0,i.useRef)({page:0}),g=(0,i.useRef)(!1),E=(0,i.useRef)(!0),P=(0,i.useRef)(50),$=(0,i.useCallback)(()=>(u.current&&(u.current.current?.abort(),u.current.current=new AbortController),++e.current),[u]),h=(0,i.useCallback)((...U)=>{let x=$();b.current?.(U),o(f=>({...f,isLoading:!0}));let O=we(s.current)(...U);function L(f){return f.name=="AbortError"||x===e.current&&(m.current?m.current(f):l.environment.launchType!==l.LaunchType.Background&&$e(f,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(C){C.hide(),y.current?.(...c.current||[])}},...v.current}),o({error:f,isLoading:!1})),f}return typeof O=="function"?(g.current=!0,O(d.current).then(({data:f,hasMore:C,cursor:ce})=>(x===e.current&&(d.current&&(d.current.cursor=ce,d.current.lastItem=f?.[f.length-1]),p.current&&p.current(f,d.current),C&&(P.current=f.length),E.current=C,o(le=>d.current.page===0?{data:f,isLoading:!1}:{data:(le.data||[])?.concat(f),isLoading:!1})),f),f=>(E.current=!1,L(f)))):(g.current=!1,O.then(f=>(x===e.current&&(p.current&&p.current(f),o({data:f,isLoading:!1})),f),L))},[p,m,c,s,o,y,b,d,v,$]);y.current=h;let R=(0,i.useCallback)(()=>{d.current={page:0};let U=c.current||[];return h(...U)},[h,c]),_=(0,i.useCallback)(async(U,x)=>{let O;try{if(x?.optimisticUpdate){$(),typeof x?.rollbackOnError!="function"&&x?.rollbackOnError!==!1&&(O=structuredClone(S.current?.value));let L=x.optimisticUpdate;o(f=>({...f,data:L(f.data)}))}return await U}catch(L){if(typeof x?.rollbackOnError=="function"){let f=x.rollbackOnError;o(C=>({...C,data:f(C.data)}))}else x?.optimisticUpdate&&x?.rollbackOnError!==!1&&o(f=>({...f,data:O}));throw L}finally{x?.shouldRevalidateAfter!==!1&&(l.environment.launchType===l.LaunchType.Background||l.environment.commandMode==="menu-bar"?await R():R())}},[R,S,o,$]),T=(0,i.useCallback)(()=>{d.current.page+=1;let U=c.current||[];h(...U)},[d,c,h]);(0,i.useEffect)(()=>{d.current={page:0},t?.execute!==!1?h(...n||[]):$()},[ge([n,t?.execute,h]),u,d]),(0,i.useEffect)(()=>()=>{$()},[$]);let M=t?.execute!==!1?a.isLoading:!1,z={...a,isLoading:M},V=g.current?{pageSize:P.current,hasMore:E.current,onLoadMore:T}:void 0;return{...z,revalidate:R,mutate:_,pagination:V}}function we(r){return r===Promise.all||r===Promise.race||r===Promise.resolve||r===Promise.reject?r.bind(Promise):r}function Z(r){return typeof r!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(r))!==null}function ke(r){return r instanceof URLSearchParams?r.toString():r}function ee(r,n=[]){function t(e){return"update"in r?r.update(e,"utf8"):r.write(e)}return{dispatch:function(e){e=ke(e),e===null?this._null():this["_"+typeof e](e)},_object:function(e){let a=/\[object (.*)\]/i,o=Object.prototype.toString.call(e),s=a.exec(o)?.[1]??"unknown:["+o+"]";s=s.toLowerCase();let u=null;if((u=n.indexOf(e))>=0){this.dispatch("[CIRCULAR:"+u+"]");return}else n.push(e);if(Buffer.isBuffer(e))return t("buffer:"),t(e.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](e);else throw new Error('Unknown object type "'+s+'"');else{let c=Object.keys(e);c=c.sort(),Z(e)||c.splice(0,0,"prototype","__proto__","constructor"),t("object:"+c.length+":");let m=this;return c.forEach(function(p){m.dispatch(p),t(":"),m.dispatch(e[p]),t(",")})}},_array:function(e,a){a=typeof a<"u"?a:!1;let o=this;if(t("array:"+e.length+":"),!a||e.length<=1){e.forEach(function(c){o.dispatch(c)});return}let s=[],u=e.map(function(c){let m=xe(),p=n.slice();return ee(m,p).dispatch(c),s=s.concat(p.slice(n.length)),m.read().toString()});n=n.concat(s),u.sort(),this._array(u,!1)},_date:function(e){t("date:"+e.toJSON())},_symbol:function(e){t("symbol:"+e.toString())},_error:function(e){t("error:"+e.toString())},_boolean:function(e){t("bool:"+e.toString())},_string:function(e){t("string:"+e.length+":"),t(e.toString())},_function:function(e){t("fn:"),Z(e)?this.dispatch("[native]"):this.dispatch(e.toString()),this.dispatch("function-name:"+String(e.name)),this._object(e)},_number:function(e){t("number:"+e.toString())},_xml:function(e){t("xml:"+e.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(e){t("regex:"+e.toString())},_uint8array:function(e){t("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){t("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){t("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){t("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){t("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){t("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){t("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){t("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){t("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){t("url:"+e.toString())},_map:function(e){t("map:");let a=Array.from(e);this._array(a,!0)},_set:function(e){t("set:");let a=Array.from(e);this._array(a,!0)},_file:function(e){t("file:"),this.dispatch([e.name,e.size,e.type,e.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(e){t("bigint:"+e.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function xe(){return{buf:"",write:function(r){this.buf+=r},end:function(r){this.buf+=r},read:function(){return this.buf}}}function ve(r,n){let t=this[r];return t instanceof Date?`__raycast_cached_date__${t.toISOString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:n}function Se(r,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function F(r){let n=Y.default.createHash("sha1");return ee(n).dispatch(r),n.digest("hex")}var Ee=Symbol("cache without namespace"),q=new Map;function Ae(r,n,t){let e=t?.cacheNamespace||Ee,a=q.get(e)||q.set(e,new l.Cache({namespace:t?.cacheNamespace})).get(e);if(!a)throw new Error("Missing cache");let o=w(r),s=w(n),u=(0,i.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(o.current)}catch(b){console.error("Could not get Cache data:",b);return}}),c=(0,i.useMemo)(()=>{if(typeof u<"u"){if(u==="undefined")return;try{return JSON.parse(u,Se)}catch(b){return console.warn("The cached data is corrupted",b),s.current}}else return s.current},[u,s]),m=w(c),p=(0,i.useCallback)(b=>{let v=typeof b=="function"?b(m.current):b;if(typeof v>"u")a.set(o.current,"undefined");else{let S=JSON.stringify(v,ve);a.set(o.current,S)}return v},[a,o,m]);return[c,p]}var D=Symbol();function Re(r,n,t){let{initialData:e,keepPreviousData:a,internal_cacheKeySuffix:o,...s}=t||{},u=(0,i.useRef)(null),[c,m]=Ae(F(n||[])+o,D,{cacheNamespace:F(r)}),p=(0,i.useRef)(c!==D?c:e),b=(0,i.useRef)(void 0),{mutate:v,revalidate:S,...y}=ye(r,n||[],{...s,onData($,h){b.current=h,s.onData&&s.onData($,h),!(h&&h.page>0)&&(u.current="promise",p.current=$,m($))}}),d,g=y.pagination;b.current&&b.current.page>0&&y.data?d=y.data:u.current==="promise"?d=p.current:a&&c!==D?(d=c,g&&(g.hasMore=!0,g.pageSize=c.length)):a&&c===D?d=p.current:c!==D?(d=c,g&&(g.hasMore=!0,g.pageSize=c.length)):d=e;let E=w(d),P=(0,i.useCallback)(async($,h)=>{let R;try{if(h?.optimisticUpdate){typeof h?.rollbackOnError!="function"&&h?.rollbackOnError!==!1&&(R=structuredClone(E.current));let _=h.optimisticUpdate(E.current);u.current="cache",p.current=_,m(_)}return await v($,{shouldRevalidateAfter:h?.shouldRevalidateAfter})}catch(_){if(typeof h?.rollbackOnError=="function"){let T=h.rollbackOnError(E.current);u.current="cache",p.current=T,m(T)}else h?.optimisticUpdate&&h?.rollbackOnError!==!1&&(u.current="cache",p.current=R,m(R));throw _}},[m,v,E,p,u]);return(0,i.useEffect)(()=>{c!==D&&(u.current="cache",p.current=c)},[c]),{data:d,isLoading:y.isLoading,error:y.error,mutate:b.current&&b.current.page>0?v:P,pagination:g,revalidate:S}}function _e(r){if(r){let n=Te(r);if(!n)return!1;if(n.subtype==="json"||n.suffix==="json"||n.suffix&&/\bjson\b/i.test(n.suffix)||n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}var Pe=/^([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126});?$/;function Te(r){let n=r.indexOf(";"),t=n!==-1?r.slice(0,n).trim():r.trim(),e=Pe.exec(t.toLowerCase().toLowerCase());if(!e)return;let a=e[1],o=e[2],s,u=o.lastIndexOf("+");return u!==-1&&(s=o.substring(u+1),o=o.substring(0,u)),{type:a,subtype:o,suffix:s}}async function Ue(r){if(!r.ok)throw new Error(r.statusText);let n=r.headers.get("content-type");return n&&_e(n)?await r.json():await r.text()}function Ce(r){return{data:r,hasMore:!1}}function te(r,n){let{parseResponse:t,mapResult:e,initialData:a,execute:o,keepPreviousData:s,onError:u,onData:c,onWillExecute:m,failureToastOptions:p,...b}=n||{},v={initialData:a,execute:o,keepPreviousData:s,onError:u,onData:c,onWillExecute:m,failureToastOptions:p},S=w(t||Ue),y=w(e||Ce),d=(0,i.useRef)(null),g=(0,i.useRef)(null),E=typeof r=="function"?r({page:0}):void 0;(!d.current||typeof g.current>"u"||g.current!==E)&&(d.current=r),g.current=E;let P=(0,i.useRef)(null),$=(0,i.useCallback)((_,T)=>async M=>{let z=await fetch(_(M),{signal:P.current?.signal,...T}),V=await S.current(z);return y.current?.(V)},[S,y]),h=(0,i.useCallback)(async(_,T)=>{let M=await fetch(_,{signal:P.current?.signal,...T}),z=await S.current(M);return y.current(z)?.data},[S,y]),R=(0,i.useMemo)(()=>g.current?$:h,[g,h,$]);return Re(R,[d.current,b],{...v,internal_cacheKeySuffix:g.current+F(y.current)+F(S.current),abortable:P})}function re(r,n){try{let t=s=>s.startsWith("http")?s:`https://${s}`,a=(typeof r=="string"?new Q.URL(t(r)):r).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:n?.fallback??l.Icon.Link,mask:n?.mask};case"apple":return{source:n?.fallback??l.Icon.Link,mask:n?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${a}.ico`,fallback:n?.fallback??l.Icon.Link,mask:n?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${n?.size??64}&domain=${a}`,fallback:n?.fallback??l.Icon.Link,mask:n?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${a}&size=${n?.size??64}`,fallback:n?.fallback??l.Icon.Link,mask:n?.mask}}}catch(t){return console.error(t),l.Icon.Link}}var ne=require("@raycast/api"),{accessToken:Ie}=(0,ne.getPreferenceValues)(),ae="https://api-ssl.bitly.com/v4",se={Authorization:`Bearer ${Ie}`,"Content-Type":"application/json"};var ie=require("react"),A=require("react/jsx-runtime"),{group_guid:G}=(0,k.getPreferenceValues)();function oe(){let[r,n]=(0,ie.useState)(""),{isLoading:t,data:e}=te(`${ae}/groups/${G}/bitlinks?query=${r}`,{headers:se,async parseResponse(a){let o=await a.json();if(!a.ok){let{message:s,errors:u}=o;throw new Error(`Bitly API Error - ${u?JSON.stringify(u):s}`)}return o},mapResult(a){return{data:a.links}},initialData:[]});return(0,A.jsx)(k.List,{isLoading:t,searchBarPlaceholder:"Search links",onSearchTextChange:n,throttle:!0,children:!t&&!e.length?r?(0,A.jsx)(k.List.EmptyView,{icon:"links-filter-empty-state",title:"No results found",description:"Try adjusting your search, filters, or try searching hidden links instead."}):(0,A.jsx)(k.List.EmptyView,{icon:"links-list-empty.png",title:"More clicks are just a link away",description:"Shorten long links and get attention by customizing what they say. No more bit.ly/3yqawYa, more bit.ly/brands-bitly.",actions:(0,A.jsx)(k.ActionPanel,{children:(0,A.jsx)(k.Action.OpenInBrowser,{title:"Create a Bitly Link",url:`https://app.bitly.com/${G}/links/create`})})}):e.map(a=>(0,A.jsx)(k.List.Item,{icon:re(a.long_url),title:a.title,subtitle:a.link,accessories:[{date:new Date(a.created_at),tooltip:new Date(a.created_at).toDateString()}],actions:(0,A.jsxs)(k.ActionPanel,{children:[(0,A.jsx)(k.Action.CopyToClipboard,{title:"Copy Bitlink",content:a.link}),(0,A.jsx)(k.Action.OpenInBrowser,{title:"Open in Bitly",url:`https://app.bitly.com/${G}/links/${a.link}/details`})]})},a.id))})}
