{
  "version": 3,
  "sources": ["../src/set-level.tsx", "../src/utils.ts", "../node_modules/run-applescript/index.js", "../src/audio-input-level-cache.ts"],
  "sourcesContent": ["import {\n  closeMainWindow,\n  LaunchProps,\n  getPreferenceValues,\n  showHUD,\n  launchCommand,\n  LaunchType,\n  openCommandPreferences,\n  showToast,\n  Toast,\n} from \"@raycast/api\";\nimport { setAudioInputLevel } from \"./utils\";\n\nexport default async function setLevel(props: LaunchProps<{ arguments: Arguments.SetLevel }>) {\n  await closeMainWindow();\n  let level = 0;\n  const defaultLevel = Number(getPreferenceValues<Preferences.SetLevel>()[\"default-level\"]);\n  let assignedLevel = 0;\n\n  if (props.arguments.level.length !== 0) {\n    level = Number(props.arguments.level);\n\n    if (isNaN(level) || 0 > level || level > 100) {\n      await showHUD(\"\u274C Level must be a number between 0 and 100\");\n      return;\n    }\n\n    assignedLevel = level;\n  } else {\n    if (isNaN(defaultLevel) || 0 > defaultLevel || defaultLevel > 100) {\n      await showHUD(\"\u274C Default level must be a number between 0 and 100\");\n      openCommandPreferences();\n      return;\n    }\n    assignedLevel = defaultLevel;\n  }\n\n  const toast = await showToast({\n    style: Toast.Style.Animated,\n    title: `Setting audio input\u2026`,\n  });\n  try {\n    await setAudioInputLevel(assignedLevel.toString());\n    toast.style = Toast.Style.Success;\n    toast.title = `Audio input set to ${assignedLevel.toString()}`;\n  } catch {\n    toast.style = Toast.Style.Failure;\n    toast.title = \"Failed to set the input level\";\n  }\n\n  // showHUD(`Audio input set to ${assignedLevel.toString()}`);\n  try {\n    await launchCommand({ name: \"mute-menu-bar\", type: LaunchType.Background });\n  } catch {\n    console.log(\"mute-menu-bar command is not active\");\n  }\n}\n", "import { showToast, Toast, environment } from \"@raycast/api\";\nimport { runAppleScript } from \"run-applescript\";\nimport { AudioInputLevelCache } from \"./audio-input-level-cache\";\nimport { platform } from \"os\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport path from \"path\";\n\nconst execAsync = promisify(exec);\n\nexport const isWindows = platform() === \"win32\";\n\nasync function getAudioInputLevel() {\n  if (isWindows) {\n    try {\n      const scriptPath = path.join(environment.assetsPath, \"scripts\", \"windows-get-level.ps1\");\n      const { stdout } = await execAsync(`powershell -ExecutionPolicy Bypass -File \"${scriptPath}\"`);\n      return stdout.trim();\n    } catch (e) {\n      console.error(e);\n      return \"0\";\n    }\n  }\n\n  const result = await runAppleScript(`\n      set result to (input volume of (get volume settings))\n      return result\n    `);\n  return result.trim();\n}\n\nexport async function setAudioInputLevel(v: string) {\n  if (isWindows) {\n    const scriptPath = path.join(environment.assetsPath, \"scripts\", \"windows-set-level.ps1\");\n    await execAsync(`powershell -ExecutionPolicy Bypass -File \"${scriptPath}\" -Level ${v}`);\n    AudioInputLevelCache.curInputLevel = v;\n    return;\n  }\n  await runAppleScript(`set volume input volume ${v}`);\n  AudioInputLevelCache.curInputLevel = v;\n}\n\nconst toggleSystemAudioInputLevelWithPreviousLevel = async (): Promise<string> => {\n  const currentLevel = await getAudioInputLevel();\n\n  if (currentLevel === \"0\") {\n    // unmute\n    const prevInputLevel = AudioInputLevelCache.prevInputLevel;\n    await setAudioInputLevel(prevInputLevel);\n    AudioInputLevelCache.curInputLevel = prevInputLevel;\n    return prevInputLevel;\n  }\n\n  // mute\n  await setAudioInputLevel(\"0\");\n  AudioInputLevelCache.prevInputLevel = currentLevel;\n  AudioInputLevelCache.curInputLevel = \"0\";\n  return \"0\";\n};\n\nexport const toggleSystemAudioInputLevel = async () => {\n  const toast = await showToast({\n    style: Toast.Style.Animated,\n    title: \"Running...\",\n  });\n\n  try {\n    const inputLevel = await toggleSystemAudioInputLevelWithPreviousLevel();\n\n    if (inputLevel === \"0\") {\n      toast.title = \"Audio input muted\";\n      toast.style = Toast.Style.Failure;\n    } else {\n      toast.title = \"Audio input unmuted\";\n      toast.style = Toast.Style.Success;\n    }\n\n    return inputLevel;\n  } catch (error) {\n    toast.title = \"Error\";\n    toast.message = String(error);\n    toast.style = Toast.Style.Failure;\n    return \"0\"; // Fail safe\n  }\n};\n", "import process from 'node:process';\nimport {promisify} from 'node:util';\nimport {execFile, execFileSync} from 'node:child_process';\n\nconst execFileAsync = promisify(execFile);\n\nexport async function runAppleScript(script, {humanReadableOutput = true, signal} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst execOptions = {};\n\tif (signal) {\n\t\texecOptions.signal = signal;\n\t}\n\n\tconst {stdout} = await execFileAsync('osascript', ['-e', script, outputArguments], execOptions);\n\treturn stdout.trim();\n}\n\nexport function runAppleScriptSync(script, {humanReadableOutput = true} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst stdout = execFileSync('osascript', ['-e', script, ...outputArguments], {\n\t\tencoding: 'utf8',\n\t\tstdio: ['ignore', 'pipe', 'ignore'],\n\t\ttimeout: 500,\n\t});\n\n\treturn stdout.trim();\n}\n", "import { Cache } from \"@raycast/api\";\n\nexport class AudioInputLevelCache {\n  private static cache = new Cache();\n  private static AudioInputLevelPreviousKey = \"audio-input-level-previous\";\n  private static AudioInputLevelCurrentKey = \"audio-input-level-current\";\n  private static AudioInputLevelDefault = \"50\";\n  private static listeners: Set<() => void> = new Set();\n\n  static get prevInputLevel(): string {\n    return (\n      this.cache.get(AudioInputLevelCache.AudioInputLevelPreviousKey) ?? AudioInputLevelCache.AudioInputLevelDefault\n    );\n  }\n\n  static set prevInputLevel(v: string) {\n    this.cache.set(AudioInputLevelCache.AudioInputLevelPreviousKey, v);\n  }\n\n  static get curInputLevel(): string {\n    return (\n      this.cache.get(AudioInputLevelCache.AudioInputLevelCurrentKey) ?? AudioInputLevelCache.AudioInputLevelDefault\n    );\n  }\n\n  static set curInputLevel(v: string) {\n    this.cache.set(AudioInputLevelCache.AudioInputLevelCurrentKey, v);\n  }\n\n  static addListener(listener: () => void) {\n    this.listeners.add(listener);\n  }\n\n  static removeListener(listener: () => void) {\n    this.listeners.delete(listener);\n  }\n}\n"],
  "mappings": "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",
  "names": ["set_level_exports", "__export", "setLevel", "__toCommonJS", "import_api", "import_api", "import_node_process", "import_node_util", "import_node_child_process", "execFileAsync", "runAppleScript", "script", "humanReadableOutput", "signal", "process", "outputArguments", "execOptions", "stdout", "import_api", "AudioInputLevelCache", "_AudioInputLevelCache", "v", "listener", "import_os", "import_child_process", "import_util", "import_path", "execAsync", "isWindows", "setAudioInputLevel", "v", "isWindows", "scriptPath", "path", "execAsync", "AudioInputLevelCache", "runAppleScript", "setLevel", "props", "level", "defaultLevel", "assignedLevel", "toast", "setAudioInputLevel"]
}
