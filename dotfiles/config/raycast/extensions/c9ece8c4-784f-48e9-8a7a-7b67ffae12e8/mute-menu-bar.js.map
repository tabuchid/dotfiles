{
  "version": 3,
  "sources": ["../src/mute-menu-bar.tsx", "../src/utils.ts", "../node_modules/run-applescript/index.js", "../src/audio-input-level-cache.ts"],
  "sourcesContent": ["import {\n  Color,\n  Icon,\n  MenuBarExtra,\n  getPreferenceValues,\n  openCommandPreferences,\n  openExtensionPreferences,\n} from \"@raycast/api\";\nimport { useEffect, useState } from \"react\";\nimport { toggleSystemAudioInputLevel } from \"./utils\";\nimport { AudioInputLevelCache } from \"./audio-input-level-cache\";\n\nexport default function muteMenuBar() {\n  const preferences = getPreferenceValues<Preferences.MuteMenuBar>();\n  const [isMuted, setIsMuted] = useState<boolean>(AudioInputLevelCache.curInputLevel === \"0\");\n\n  useEffect(() => {\n    const updateIconVisibility = () => {\n      const currentAudioInputLevelCached = AudioInputLevelCache.curInputLevel;\n      setIsMuted(currentAudioInputLevelCached === \"0\");\n    };\n\n    AudioInputLevelCache.addListener(updateIconVisibility);\n\n    return () => {\n      AudioInputLevelCache.removeListener(updateIconVisibility);\n    };\n  }, []);\n\n  const iconColor = preferences.tint === \"true\" ? Color.Red : Color.PrimaryText;\n  const disabledIcon = { source: Icon.MicrophoneDisabled, tintColor: iconColor };\n  const enabledIcon = { source: Icon.Microphone };\n  const icon = isMuted ? disabledIcon : enabledIcon;\n  const menuItemText = isMuted ? \"Unmute\" : \"Mute\";\n\n  const handleToggleIconButton = async () => {\n    if (isMuted) {\n      AudioInputLevelCache.curInputLevel = AudioInputLevelCache.prevInputLevel;\n    } else {\n      AudioInputLevelCache.prevInputLevel = AudioInputLevelCache.curInputLevel;\n      AudioInputLevelCache.curInputLevel = \"0\";\n    }\n    await toggleSystemAudioInputLevel();\n    setIsMuted(!isMuted);\n  };\n\n  if (preferences.hideIconWhenUnmuted && !isMuted) {\n    return null;\n  }\n\n  return (\n    <MenuBarExtra icon={icon} tooltip=\"Audio input volume\">\n      <MenuBarExtra.Section>\n        <MenuBarExtra.Item title={menuItemText} onAction={handleToggleIconButton} />\n      </MenuBarExtra.Section>\n      <MenuBarExtra.Section>\n        <MenuBarExtra.Item title=\"Configure default level\" onAction={openExtensionPreferences} />\n        <MenuBarExtra.Item icon={Icon.Gear} title=\"Settings\" onAction={openCommandPreferences} />\n      </MenuBarExtra.Section>\n    </MenuBarExtra>\n  );\n}\n", "import { showToast, Toast, environment } from \"@raycast/api\";\nimport { runAppleScript } from \"run-applescript\";\nimport { AudioInputLevelCache } from \"./audio-input-level-cache\";\nimport { platform } from \"os\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport path from \"path\";\n\nconst execAsync = promisify(exec);\n\nexport const isWindows = platform() === \"win32\";\n\nasync function getAudioInputLevel() {\n  if (isWindows) {\n    try {\n      const scriptPath = path.join(environment.assetsPath, \"scripts\", \"windows-get-level.ps1\");\n      const { stdout } = await execAsync(`powershell -ExecutionPolicy Bypass -File \"${scriptPath}\"`);\n      return stdout.trim();\n    } catch (e) {\n      console.error(e);\n      return \"0\";\n    }\n  }\n\n  const result = await runAppleScript(`\n      set result to (input volume of (get volume settings))\n      return result\n    `);\n  return result.trim();\n}\n\nexport async function setAudioInputLevel(v: string) {\n  if (isWindows) {\n    const scriptPath = path.join(environment.assetsPath, \"scripts\", \"windows-set-level.ps1\");\n    await execAsync(`powershell -ExecutionPolicy Bypass -File \"${scriptPath}\" -Level ${v}`);\n    AudioInputLevelCache.curInputLevel = v;\n    return;\n  }\n  await runAppleScript(`set volume input volume ${v}`);\n  AudioInputLevelCache.curInputLevel = v;\n}\n\nconst toggleSystemAudioInputLevelWithPreviousLevel = async (): Promise<string> => {\n  const currentLevel = await getAudioInputLevel();\n\n  if (currentLevel === \"0\") {\n    // unmute\n    const prevInputLevel = AudioInputLevelCache.prevInputLevel;\n    await setAudioInputLevel(prevInputLevel);\n    AudioInputLevelCache.curInputLevel = prevInputLevel;\n    return prevInputLevel;\n  }\n\n  // mute\n  await setAudioInputLevel(\"0\");\n  AudioInputLevelCache.prevInputLevel = currentLevel;\n  AudioInputLevelCache.curInputLevel = \"0\";\n  return \"0\";\n};\n\nexport const toggleSystemAudioInputLevel = async () => {\n  const toast = await showToast({\n    style: Toast.Style.Animated,\n    title: \"Running...\",\n  });\n\n  try {\n    const inputLevel = await toggleSystemAudioInputLevelWithPreviousLevel();\n\n    if (inputLevel === \"0\") {\n      toast.title = \"Audio input muted\";\n      toast.style = Toast.Style.Failure;\n    } else {\n      toast.title = \"Audio input unmuted\";\n      toast.style = Toast.Style.Success;\n    }\n\n    return inputLevel;\n  } catch (error) {\n    toast.title = \"Error\";\n    toast.message = String(error);\n    toast.style = Toast.Style.Failure;\n    return \"0\"; // Fail safe\n  }\n};\n", "import process from 'node:process';\nimport {promisify} from 'node:util';\nimport {execFile, execFileSync} from 'node:child_process';\n\nconst execFileAsync = promisify(execFile);\n\nexport async function runAppleScript(script, {humanReadableOutput = true, signal} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst execOptions = {};\n\tif (signal) {\n\t\texecOptions.signal = signal;\n\t}\n\n\tconst {stdout} = await execFileAsync('osascript', ['-e', script, outputArguments], execOptions);\n\treturn stdout.trim();\n}\n\nexport function runAppleScriptSync(script, {humanReadableOutput = true} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst stdout = execFileSync('osascript', ['-e', script, ...outputArguments], {\n\t\tencoding: 'utf8',\n\t\tstdio: ['ignore', 'pipe', 'ignore'],\n\t\ttimeout: 500,\n\t});\n\n\treturn stdout.trim();\n}\n", "import { Cache } from \"@raycast/api\";\n\nexport class AudioInputLevelCache {\n  private static cache = new Cache();\n  private static AudioInputLevelPreviousKey = \"audio-input-level-previous\";\n  private static AudioInputLevelCurrentKey = \"audio-input-level-current\";\n  private static AudioInputLevelDefault = \"50\";\n  private static listeners: Set<() => void> = new Set();\n\n  static get prevInputLevel(): string {\n    return (\n      this.cache.get(AudioInputLevelCache.AudioInputLevelPreviousKey) ?? AudioInputLevelCache.AudioInputLevelDefault\n    );\n  }\n\n  static set prevInputLevel(v: string) {\n    this.cache.set(AudioInputLevelCache.AudioInputLevelPreviousKey, v);\n  }\n\n  static get curInputLevel(): string {\n    return (\n      this.cache.get(AudioInputLevelCache.AudioInputLevelCurrentKey) ?? AudioInputLevelCache.AudioInputLevelDefault\n    );\n  }\n\n  static set curInputLevel(v: string) {\n    this.cache.set(AudioInputLevelCache.AudioInputLevelCurrentKey, v);\n  }\n\n  static addListener(listener: () => void) {\n    this.listeners.add(listener);\n  }\n\n  static removeListener(listener: () => void) {\n    this.listeners.delete(listener);\n  }\n}\n"],
  "mappings": "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",
  "names": ["mute_menu_bar_exports", "__export", "muteMenuBar", "__toCommonJS", "import_api", "import_react", "import_api", "import_node_process", "import_node_util", "import_node_child_process", "execFileAsync", "runAppleScript", "script", "humanReadableOutput", "signal", "process", "outputArguments", "execOptions", "stdout", "import_api", "AudioInputLevelCache", "_AudioInputLevelCache", "v", "listener", "import_os", "import_child_process", "import_util", "import_path", "execAsync", "isWindows", "getAudioInputLevel", "scriptPath", "path", "stdout", "e", "runAppleScript", "setAudioInputLevel", "v", "AudioInputLevelCache", "toggleSystemAudioInputLevelWithPreviousLevel", "currentLevel", "prevInputLevel", "toggleSystemAudioInputLevel", "toast", "inputLevel", "error", "import_jsx_runtime", "muteMenuBar", "preferences", "isMuted", "setIsMuted", "AudioInputLevelCache", "updateIconVisibility", "currentAudioInputLevelCached", "iconColor", "disabledIcon", "enabledIcon", "icon", "menuItemText", "handleToggleIconButton", "toggleSystemAudioInputLevel"]
}
