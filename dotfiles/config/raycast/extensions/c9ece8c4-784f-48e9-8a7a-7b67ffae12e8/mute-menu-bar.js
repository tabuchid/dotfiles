"use strict";var T=Object.create;var l=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var o in t)l(e,o,{get:t[o],enumerable:!0})},I=(e,t,o,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of $(t))!W.call(e,i)&&i!==o&&l(e,i,{get:()=>t[i],enumerable:!(c=D(t,i))||c.enumerable});return e};var L=(e,t,o)=>(o=e!=null?T(O(e)):{},I(t||!e||!e.__esModule?l(o,"default",{value:e,enumerable:!0}):o,e)),U=e=>I(l({},"__esModule",{value:!0}),e);var k={};R(k,{default:()=>E});module.exports=U(k);var r=require("@raycast/api"),p=require("react");var u=require("@raycast/api");var y=L(require("node:process"),1),g=require("node:util"),m=require("node:child_process"),V=(0,g.promisify)(m.execFile);async function v(e,{humanReadableOutput:t=!0,signal:o}={}){if(y.default.platform!=="darwin")throw new Error("macOS only");let c=t?[]:["-ss"],i={};o&&(i.signal=o);let{stdout:a}=await V("osascript",["-e",e,c],i);return a.trim()}var h=require("@raycast/api"),n=class e{static cache=new h.Cache;static AudioInputLevelPreviousKey="audio-input-level-previous";static AudioInputLevelCurrentKey="audio-input-level-current";static AudioInputLevelDefault="50";static listeners=new Set;static get prevInputLevel(){return this.cache.get(e.AudioInputLevelPreviousKey)??e.AudioInputLevelDefault}static set prevInputLevel(t){this.cache.set(e.AudioInputLevelPreviousKey,t)}static get curInputLevel(){return this.cache.get(e.AudioInputLevelCurrentKey)??e.AudioInputLevelDefault}static set curInputLevel(t){this.cache.set(e.AudioInputLevelCurrentKey,t)}static addListener(t){this.listeners.add(t)}static removeListener(t){this.listeners.delete(t)}};var w=require("os"),S=require("child_process"),x=require("util"),d=L(require("path")),P=(0,x.promisify)(S.exec),M=(0,w.platform)()==="win32";async function j(){if(M)try{let t=d.default.join(u.environment.assetsPath,"scripts","windows-get-level.ps1"),{stdout:o}=await P(`powershell -ExecutionPolicy Bypass -File "${t}"`);return o.trim()}catch(t){return console.error(t),"0"}return(await v(`
      set result to (input volume of (get volume settings))
      return result
    `)).trim()}async function A(e){if(M){let t=d.default.join(u.environment.assetsPath,"scripts","windows-set-level.ps1");await P(`powershell -ExecutionPolicy Bypass -File "${t}" -Level ${e}`),n.curInputLevel=e;return}await v(`set volume input volume ${e}`),n.curInputLevel=e}var G=async()=>{let e=await j();if(e==="0"){let t=n.prevInputLevel;return await A(t),n.curInputLevel=t,t}return await A("0"),n.prevInputLevel=e,n.curInputLevel="0","0"},C=async()=>{let e=await(0,u.showToast)({style:u.Toast.Style.Animated,title:"Running..."});try{let t=await G();return t==="0"?(e.title="Audio input muted",e.style=u.Toast.Style.Failure):(e.title="Audio input unmuted",e.style=u.Toast.Style.Success),t}catch(t){return e.title="Error",e.message=String(t),e.style=u.Toast.Style.Failure,"0"}};var s=require("react/jsx-runtime");function E(){let e=(0,r.getPreferenceValues)(),[t,o]=(0,p.useState)(n.curInputLevel==="0");(0,p.useEffect)(()=>{let f=()=>{let b=n.curInputLevel;o(b==="0")};return n.addListener(f),()=>{n.removeListener(f)}},[]);let c=e.tint==="true"?r.Color.Red:r.Color.PrimaryText,i={source:r.Icon.MicrophoneDisabled,tintColor:c},a={source:r.Icon.Microphone},B=t?i:a,F=t?"Unmute":"Mute",K=async()=>{t?n.curInputLevel=n.prevInputLevel:(n.prevInputLevel=n.curInputLevel,n.curInputLevel="0"),await C(),o(!t)};return e.hideIconWhenUnmuted&&!t?null:(0,s.jsxs)(r.MenuBarExtra,{icon:B,tooltip:"Audio input volume",children:[(0,s.jsx)(r.MenuBarExtra.Section,{children:(0,s.jsx)(r.MenuBarExtra.Item,{title:F,onAction:K})}),(0,s.jsxs)(r.MenuBarExtra.Section,{children:[(0,s.jsx)(r.MenuBarExtra.Item,{title:"Configure default level",onAction:r.openExtensionPreferences}),(0,s.jsx)(r.MenuBarExtra.Item,{icon:r.Icon.Gear,title:"Settings",onAction:r.openCommandPreferences})]})]})}
