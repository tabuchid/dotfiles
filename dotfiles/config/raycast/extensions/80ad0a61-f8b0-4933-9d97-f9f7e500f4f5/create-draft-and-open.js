"use strict";var Y=Object.create;var h=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var A=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),re=(e,t)=>{for(var r in t)h(e,r,{get:t[r],enumerable:!0})},F=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Z(t))!te.call(e,n)&&n!==r&&h(e,n,{get:()=>t[n],enumerable:!(a=J(t,n))||a.enumerable});return e};var ne=(e,t,r)=>(r=e!=null?Y(ee(e)):{},F(t||!e||!e.__esModule?h(r,"default",{value:e,enumerable:!0}):r,e)),ae=e=>F(h({},"__esModule",{value:!0}),e);var _=A((De,I)=>{"use strict";var N=require("fs"),k;function se(){try{return N.statSync("/.dockerenv"),!0}catch{return!1}}function ie(){try{return N.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}I.exports=()=>(k===void 0&&(k=se()||ie()),k)});var v=A((Ee,C)=>{"use strict";var oe=require("os"),ce=require("fs"),L=_(),U=()=>{if(process.platform!=="linux")return!1;if(oe.release().toLowerCase().includes("microsoft"))return!L();try{return ce.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!L():!1}catch{return!1}};process.env.__IS_WSL_TEST__?C.exports=U:C.exports=U()});var W=A((xe,q)=>{"use strict";q.exports=(e,t,r)=>{let a=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0});return Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){let n=r();return a(n),n},set(n){a(n)}}),e}});var Q=A((ke,X)=>{var le=require("path"),ue=require("child_process"),{promises:w,constants:$}=require("fs"),T=v(),fe=_(),b=W(),B=le.join(__dirname,"xdg-open"),{platform:d,arch:G}=process,pe=()=>{try{return w.statSync("/run/.containerenv"),!0}catch{return!1}},y;function de(){return y===void 0&&(y=pe()||fe()),y}var me=(()=>{let e="/mnt/",t;return async function(){if(t)return t;let r="/etc/wsl.conf",a=!1;try{await w.access(r,$.F_OK),a=!0}catch{}if(!a)return e;let n=await w.readFile(r,{encoding:"utf8"}),u=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(n);return u?(t=u.groups.mountPoint.trim(),t=t.endsWith("/")?t:`${t}/`,t):e}})(),M=async(e,t)=>{let r;for(let a of e)try{return await t(a)}catch(n){r=n}throw r},P=async e=>{if(e={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...e},Array.isArray(e.app))return M(e.app,s=>P({...e,app:s}));let{name:t,arguments:r=[]}=e.app||{};if(r=[...r],Array.isArray(t))return M(t,s=>P({...e,app:{name:s,arguments:r}}));let a,n=[],u={};if(d==="darwin")a="open",e.wait&&n.push("--wait-apps"),e.background&&n.push("--background"),e.newInstance&&n.push("--new"),t&&n.push("-a",t);else if(d==="win32"||T&&!de()&&!t){let s=await me();a=T?`${s}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,n.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),T||(u.windowsVerbatimArguments=!0);let o=["Start"];e.wait&&o.push("-Wait"),t?(o.push(`"\`"${t}\`""`,"-ArgumentList"),e.target&&r.unshift(e.target)):e.target&&o.push(`"${e.target}"`),r.length>0&&(r=r.map(l=>`"\`"${l}\`""`),o.push(r.join(","))),e.target=Buffer.from(o.join(" "),"utf16le").toString("base64")}else{if(t)a=t;else{let s=!__dirname||__dirname==="/",o=!1;try{await w.access(B,$.X_OK),o=!0}catch{}a=process.versions.electron||d==="android"||s||!o?"xdg-open":B}r.length>0&&n.push(...r),e.wait||(u.stdio="ignore",u.detached=!0)}e.target&&n.push(e.target),d==="darwin"&&r.length>0&&n.push("--args",...r);let i=ue.spawn(a,n,u);return e.wait?new Promise((s,o)=>{i.once("error",o),i.once("close",l=>{if(!e.allowNonzeroExitCode&&l>0){o(new Error(`Exited with code ${l}`));return}s(i)})}):(i.unref(),i)},S=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `target`");return P({...t,target:e})},ge=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `name`");let{arguments:r=[]}=t||{};if(r!=null&&!Array.isArray(r))throw new TypeError("Expected `appArguments` as Array type");return P({...t,app:{name:e,arguments:r}})};function K(e){if(typeof e=="string"||Array.isArray(e))return e;let{[G]:t}=e;if(!t)throw new Error(`${G} is not supported`);return t}function R({[d]:e},{wsl:t}){if(t&&T)return K(t);if(!e)throw new Error(`${d} is not supported`);return K(e)}var D={};b(D,"chrome",()=>R({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));b(D,"firefox",()=>R({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));b(D,"edge",()=>R({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));S.apps=D;S.openApp=ge;X.exports=S});var we={};re(we,{default:()=>j});module.exports=ae(we);var c=require("@raycast/api"),O=require("react");var V=ne(Q()),E=class{constructor(t){this.callbackParams=[];this.baseUrl=t}getBaseUrl(){return this.baseUrl}getParams(){return this.callbackParams}addParam(t){this.callbackParams.push(t)}createCallbackUrl(){let t=0,r=this.baseUrl;return this.callbackParams.forEach(function(a){r=r+(t==0?"":"&")+a.name+"="+encodeURIComponent(a.value),t=t+1}),r}async openCallbackUrl(){await(0,V.default)(this.createCallbackUrl())}};var z={CREATE_DRAFT:"drafts://x-callback-url/create?",OPEN_DRAFT:"drafts://x-callback-url/open?",RUN_ACTION:"drafts://x-callback-url/runAction?",OPEN_WORKSPACE:"drafts://x-callback-url/workspace?",APPEND_TO_DRAFT:"drafts://x-callback-url/append?",PREPEND_TO_DRAFT:"drafts://x-callback-url/prepend?",DICTATE:"drafts://x-callback-url/dictate?"};var m={APP_NAME:"Drafts",APP_BUNDLE_ID:"com.agiletortoise.Drafts-OSX",APP_DOWNLOAD_LINK:"https://getdrafts.com"},g={RECENT_TAGS:"recent_tags",RECENT_TAGS_MAX:10};var x=require("@raycast/api");var p=require("@raycast/api");async function he(){return(await(0,p.getApplications)()).some(({bundleId:t})=>t===m.APP_BUNDLE_ID)}async function H(){if(!await he()){let e={style:p.Toast.Style.Failure,title:m.APP_NAME+" is not installed.",message:"Install it from: "+m.APP_DOWNLOAD_LINK,primaryAction:{title:"Open "+m.APP_DOWNLOAD_LINK,onAction:t=>{(0,p.open)(m.APP_DOWNLOAD_LINK),t.hide()}}};return await(0,p.showToast)(e),!1}return!0}var f=require("react/jsx-runtime"),Ae=c.Toast.Style;async function Te(e){let t=await x.LocalStorage.getItem(g.RECENT_TAGS),r=[];t&&(r=t.split(","));let a=g.RECENT_TAGS_MAX,n=r.filter(l=>e.includes(l)),u=e.filter(l=>!n.includes(l)),i=r.filter(l=>!n.includes(l)),s=[...n,...u,...i],o=[];for(;o.length<a&&s[0];)o.push(s[0]),s.shift();await x.LocalStorage.setItem(g.RECENT_TAGS,o.join(","))}function j(){H();let[e,t]=(0,O.useState)(!0),[r,a]=(0,O.useState)([]);async function n(){let i=await x.LocalStorage.getItem(g.RECENT_TAGS),s=[];i&&(s=i.split(","),a(s)),t(!1)}r.length==0&&n();async function u(i){if(i.content===""){await(0,c.showToast)({style:Ae.Failure,title:"Input Error",message:"no content provided"});return}let s=new E(z.CREATE_DRAFT);if(i.tags!=""){let o=i.tags.split(",");Te(o),o.map(l=>s.addParam({name:"tag",value:l}))}i.recentTags.length>0&&i.recentTags.map(l=>s.addParam({name:"tag",value:l})),s.addParam({name:"text",value:i.content}),await s.openCallbackUrl(),await(0,c.popToRoot)({clearSearchBar:!0}),await(0,c.closeMainWindow)()}return(0,f.jsxs)(c.Form,{isLoading:e,actions:(0,f.jsx)(c.ActionPanel,{children:(0,f.jsx)(c.Action.SubmitForm,{onSubmit:u,title:"Create and Open Draft"})}),children:[(0,f.jsx)(c.Form.TextArea,{id:"content",title:"Content",placeholder:"Enter content",defaultValue:"",autoFocus:!0}),(0,f.jsx)(c.Form.TagPicker,{id:"recentTags",title:"Recent Tags",defaultValue:[],placeholder:"Press Enter to search and select recent tags",children:r.map((i,s)=>(0,f.jsx)(c.Form.TagPicker.Item,{title:i.toString(),value:i.toString()},"recentTag"+s.toString()))}),(0,f.jsx)(c.Form.TextField,{id:"tags",title:"tags",placeholder:"Enter comma separated tags",defaultValue:""})]})}
