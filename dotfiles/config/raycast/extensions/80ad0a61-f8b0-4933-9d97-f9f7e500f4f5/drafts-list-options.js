"use strict";var te=Object.create;var A=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var x=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),oe=(e,t)=>{for(var n in t)A(e,n,{get:t[n],enumerable:!0})},v=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ne(t))!ie.call(e,o)&&o!==n&&A(e,o,{get:()=>t[o],enumerable:!(a=re(t,o))||a.enumerable});return e};var se=(e,t,n)=>(n=e!=null?te(ae(e)):{},v(t||!e||!e.__esModule?A(n,"default",{value:e,enumerable:!0}):n,e)),ce=e=>v(A({},"__esModule",{value:!0}),e);var C=x((Ee,W)=>{"use strict";var q=require("fs"),y;function le(){try{return q.statSync("/.dockerenv"),!0}catch{return!1}}function ue(){try{return q.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}W.exports=()=>(y===void 0&&(y=le()||ue()),y)});var M=x((_e,E)=>{"use strict";var fe=require("os"),pe=require("fs"),B=C(),Q=()=>{if(process.platform!=="linux")return!1;if(fe.release().toLowerCase().includes("microsoft"))return!B();try{return pe.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!B():!1}catch{return!1}};process.env.__IS_WSL_TEST__?E.exports=Q:E.exports=Q()});var K=x((Se,G)=>{"use strict";G.exports=(e,t,n)=>{let a=o=>Object.defineProperty(e,t,{value:o,enumerable:!0,writable:!0});return Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){let o=n();return a(o),o},set(o){a(o)}}),e}});var Y=x((Fe,J)=>{var de=require("path"),me=require("child_process"),{promises:k,constants:H}=require("fs"),w=M(),he=C(),S=K(),$=de.join(__dirname,"xdg-open"),{platform:h,arch:X}=process,De=()=>{try{return k.statSync("/run/.containerenv"),!0}catch{return!1}},_;function ge(){return _===void 0&&(_=De()||he()),_}var Pe=(()=>{let e="/mnt/",t;return async function(){if(t)return t;let n="/etc/wsl.conf",a=!1;try{await k.access(n,H.F_OK),a=!0}catch{}if(!a)return e;let o=await k.readFile(n,{encoding:"utf8"}),c=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(o);return c?(t=c.groups.mountPoint.trim(),t=t.endsWith("/")?t:`${t}/`,t):e}})(),V=async(e,t)=>{let n;for(let a of e)try{return await t(a)}catch(o){n=o}throw n},b=async e=>{if(e={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...e},Array.isArray(e.app))return V(e.app,p=>b({...e,app:p}));let{name:t,arguments:n=[]}=e.app||{};if(n=[...n],Array.isArray(t))return V(t,p=>b({...e,app:{name:p,arguments:n}}));let a,o=[],c={};if(h==="darwin")a="open",e.wait&&o.push("--wait-apps"),e.background&&o.push("--background"),e.newInstance&&o.push("--new"),t&&o.push("-a",t);else if(h==="win32"||w&&!ge()&&!t){let p=await Pe();a=w?`${p}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,o.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),w||(c.windowsVerbatimArguments=!0);let l=["Start"];e.wait&&l.push("-Wait"),t?(l.push(`"\`"${t}\`""`,"-ArgumentList"),e.target&&n.unshift(e.target)):e.target&&l.push(`"${e.target}"`),n.length>0&&(n=n.map(m=>`"\`"${m}\`""`),l.push(n.join(","))),e.target=Buffer.from(l.join(" "),"utf16le").toString("base64")}else{if(t)a=t;else{let p=!__dirname||__dirname==="/",l=!1;try{await k.access($,H.X_OK),l=!0}catch{}a=process.versions.electron||h==="android"||p||!l?"xdg-open":$}n.length>0&&o.push(...n),e.wait||(c.stdio="ignore",c.detached=!0)}e.target&&o.push(e.target),h==="darwin"&&n.length>0&&o.push("--args",...n);let f=me.spawn(a,o,c);return e.wait?new Promise((p,l)=>{f.once("error",l),f.once("close",m=>{if(!e.allowNonzeroExitCode&&m>0){l(new Error(`Exited with code ${m}`));return}p(f)})}):(f.unref(),f)},F=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `target`");return b({...t,target:e})},Ae=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `name`");let{arguments:n=[]}=t||{};if(n!=null&&!Array.isArray(n))throw new TypeError("Expected `appArguments` as Array type");return b({...t,app:{name:e,arguments:n}})};function z(e){if(typeof e=="string"||Array.isArray(e))return e;let{[X]:t}=e;if(!t)throw new Error(`${X} is not supported`);return t}function O({[h]:e},{wsl:t}){if(t&&w)return z(t);if(!e)throw new Error(`${h} is not supported`);return z(e)}var T={};S(T,"chrome",()=>O({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));S(T,"firefox",()=>O({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));S(T,"edge",()=>O({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));F.apps=T;F.openApp=Ae;J.exports=F});var ye={};oe(ye,{default:()=>ee});module.exports=ce(ye);var r=require("@raycast/api"),N=require("react"),U=require("@raycast/api");var j=se(Y()),g=class{constructor(t){this.callbackParams=[];this.baseUrl=t}getBaseUrl(){return this.baseUrl}getParams(){return this.callbackParams}addParam(t){this.callbackParams.push(t)}createCallbackUrl(){let t=0,n=this.baseUrl;return this.callbackParams.forEach(function(a){n=n+(t==0?"":"&")+a.name+"="+encodeURIComponent(a.value),t=t+1}),n}async openCallbackUrl(){await(0,j.default)(this.createCallbackUrl())}};var P={CREATE_DRAFT:"drafts://x-callback-url/create?",OPEN_DRAFT:"drafts://x-callback-url/open?",RUN_ACTION:"drafts://x-callback-url/runAction?",OPEN_WORKSPACE:"drafts://x-callback-url/workspace?",APPEND_TO_DRAFT:"drafts://x-callback-url/append?",PREPEND_TO_DRAFT:"drafts://x-callback-url/prepend?",DICTATE:"drafts://x-callback-url/dictate?"};var D={APP_NAME:"Drafts",APP_BUNDLE_ID:"com.agiletortoise.Drafts-OSX",APP_DOWNLOAD_LINK:"https://getdrafts.com"};var d=require("@raycast/api");async function xe(){return(await(0,d.getApplications)()).some(({bundleId:t})=>t===D.APP_BUNDLE_ID)}async function Z(){if(!await xe()){let e={style:d.Toast.Style.Failure,title:D.APP_NAME+" is not installed.",message:"Install it from: "+D.APP_DOWNLOAD_LINK,primaryAction:{title:"Open "+D.APP_DOWNLOAD_LINK,onAction:t=>{(0,d.open)(D.APP_DOWNLOAD_LINK),t.hide()}}};return await(0,d.showToast)(e),!1}return!0}var i=require("react/jsx-runtime"),I=r.Toast.Style,L=class{constructor(t,n,a,o){this.title="";this.uuid="";this.preferPrepend=!1;this.prefix="";this.setTitle(t),this.setUuid(n),this.setPreferPrepend(o),this.setPrefix(a)}setTitle(t){this.title=t}setUuid(t){this.uuid=t}setPrefix(t){this.prefix=t}setPreferPrepend(t){this.preferPrepend=t}};function R(e){return(0,i.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add Draft",target:(0,i.jsx)(Te,{onCreate:e.onCreate})})}function we(e){async function t(n){let a=new g(P.APPEND_TO_DRAFT);a.addParam({name:"uuid",value:e.draftUuid}),a.addParam({name:"text",value:e.draftPrefix+n.content}),a.openCallbackUrl(),await(0,r.popToRoot)({clearSearchBar:!0}),await(0,r.closeMainWindow)()}return(0,i.jsx)(r.Form,{actions:(0,i.jsx)(r.ActionPanel,{children:(0,i.jsx)(r.Action.SubmitForm,{onSubmit:t,title:'Append to Draft "'+e.draftTitle+'"'})}),children:(0,i.jsx)(r.Form.TextArea,{id:"content",title:"Text",placeholder:"Enter text to append to draft",defaultValue:"",autoFocus:!0})})}function ke(e){async function t(n){let a=new g(P.PREPEND_TO_DRAFT);a.addParam({name:"uuid",value:e.draftUuid}),a.addParam({name:"text",value:e.draftPrefix+n.content}),a.openCallbackUrl(),await(0,r.popToRoot)({clearSearchBar:!0}),await(0,r.closeMainWindow)()}return(0,i.jsx)(r.Form,{actions:(0,i.jsx)(r.ActionPanel,{children:(0,i.jsx)(r.Action.SubmitForm,{onSubmit:t,title:'Prepend to Draft "'+e.draftTitle+'"'})}),children:(0,i.jsx)(r.Form.TextArea,{id:"content",title:"Text",placeholder:"Enter text to prepend to draft",defaultValue:"",autoFocus:!0})})}function be(e){return(0,i.jsx)(r.Action,{icon:r.Icon.Trash,title:"Remove Draft",onAction:e.onDelete})}function Te(e){let{pop:t}=(0,r.useNavigation)();async function n(a){let o=!0,c="",f="";a.title.length==0&&(o=!1,c="Title must not be empty!"),o&&a.uuid.length==0&&(o=!1,c="UUID must not be empty!",f="copy the UUID from an existing Draft"),o?(e.onCreate(new L(a.title,a.uuid,a.prefix,a.preferesPrepend)),t()):await(0,r.showToast)({style:I.Failure,title:c,message:f})}return(0,i.jsxs)(r.Form,{actions:(0,i.jsx)(r.ActionPanel,{children:(0,i.jsx)(r.Action.SubmitForm,{title:"Add Draft",onSubmit:n})}),children:[(0,i.jsx)(r.Form.TextField,{id:"title",title:"Title for the Draft",placeholder:"user defined title for the Draft",info:"choose any title you like to see in the list in raycast - the title doesn't need to match between Raycast and Drafts",autoFocus:!0}),(0,i.jsx)(r.Form.TextField,{id:"uuid",title:"UUID of the Draft",placeholder:"paste the uuid of the Draft",info:"copy & paste the uuid of the Draft you want to configure by clicking on the (i) symbol in the bottom bar"}),(0,i.jsx)(r.Form.TextField,{id:"prefix",title:"prefix",placeholder:"prefixed text",info:'the prefix will be prepended to the input text, use "- " for a bullet list or "- [ ] " for tasks'}),(0,i.jsx)(r.Form.Checkbox,{id:"preferesPrepend",title:"Prepend to Draft",defaultValue:!1,label:"if checked the text will be prepended to this Draft"})]})}function ee(){Z();let[e,t]=(0,N.useState)([]),[n,a]=(0,N.useState)(!0);async function o(){let s=await U.LocalStorage.getItem("stored-drafts");if(s){let u=JSON.parse(s);t(u)}a(!1)}async function c(s){let u=JSON.stringify(s);await U.LocalStorage.setItem("stored-drafts",u),o()}e.length==0&&o();async function f(s){let u=[...e,s];c(u),t(u),await(0,r.showToast)({style:I.Success,title:'Added Draft "'+s.title+'"'})}async function p(s){let u=[...e];u.splice(s,1),c(u),t(u),await(0,r.showToast)({style:I.Success,title:"Removed Draft"})}function l(s){return s.preferPrepend?(0,i.jsx)(r.Action.Push,{title:"Prepend to Draft",target:(0,i.jsx)(ke,{draftTitle:s.title,draftUuid:s.uuid,draftPrefix:s.prefix})}):(0,i.jsx)(r.Action.Push,{title:"Append to Draft",target:(0,i.jsx)(we,{draftTitle:s.title,draftUuid:s.uuid,draftPrefix:s.prefix})})}function m(s){return s.preferPrepend?(0,i.jsx)(r.Action.CreateQuicklink,{quicklink:{link:P.PREPEND_TO_DRAFT+"uuid="+s.uuid+"&text="+encodeURIComponent(s.prefix)+"{text}"},icon:r.Icon.Link,title:'Create Quicklink to Prepend to Draft "'+s.title+'"'}):(0,i.jsx)(r.Action.CreateQuicklink,{quicklink:{link:P.APPEND_TO_DRAFT+"uuid="+s.uuid+"&text="+encodeURIComponent(s.prefix)+"{text}"},icon:r.Icon.Link,title:'Create Quicklink to Append to Draft "'+s.title+'"'})}return(0,i.jsxs)(r.List,{navigationTitle:"Search Drafts",searchBarPlaceholder:"Search Drafts you want to append / prepend text to",actions:(0,i.jsx)(r.ActionPanel,{children:(0,i.jsx)(R,{onCreate:f})}),isLoading:n,children:[(0,i.jsx)(r.List.EmptyView,{actions:(0,i.jsx)(r.ActionPanel,{children:(0,i.jsx)(R,{onCreate:f})}),title:"No Drafts Configured!",description:"Configure Quick Drafts you want to append / prepend text to from Raycast",icon:"\u2699\uFE0F"}),e.map((s,u)=>(0,i.jsx)(r.List.Item,{title:s.title,icon:r.Icon.List,actions:(0,i.jsxs)(r.ActionPanel,{children:[(0,i.jsxs)(r.ActionPanel.Section,{children:[l(s),m(s),(0,i.jsx)(be,{onDelete:()=>p(u)})]}),(0,i.jsx)(R,{onCreate:f})]})},u))]})}
