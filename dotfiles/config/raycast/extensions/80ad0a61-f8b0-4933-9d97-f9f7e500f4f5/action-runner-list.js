"use strict";var rt=Object.create;var g=Object.defineProperty;var it=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),st=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},q=(t,e,r,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of at(e))!ct.call(t,o)&&o!==r&&g(t,o,{get:()=>e[o],enumerable:!(a=it(e,o))||a.enumerable});return t};var U=(t,e,r)=>(r=t!=null?rt(ot(t)):{},q(e||!t||!t.__esModule?g(r,"default",{value:t,enumerable:!0}):r,t)),lt=t=>q(g({},"__esModule",{value:!0}),t);var E=w((_t,B)=>{"use strict";var W=require("fs"),b;function ut(){try{return W.statSync("/.dockerenv"),!0}catch{return!1}}function ft(){try{return W.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}B.exports=()=>(b===void 0&&(b=ut()||ft()),b)});var G=w((Tt,S)=>{"use strict";var pt=require("os"),dt=require("fs"),Q=E(),M=()=>{if(process.platform!=="linux")return!1;if(pt.release().toLowerCase().includes("microsoft"))return!Q();try{return dt.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!Q():!1}catch{return!1}};process.env.__IS_WSL_TEST__?S.exports=M:S.exports=M()});var $=w((Nt,K)=>{"use strict";K.exports=(t,e,r)=>{let a=o=>Object.defineProperty(t,e,{value:o,enumerable:!0,writable:!0});return Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){let o=r();return a(o),o},set(o){a(o)}}),t}});var R=w((It,Y)=>{var mt=require("path"),At=require("child_process"),{promises:D,constants:J}=require("fs"),k=G(),ht=E(),T=$(),X=mt.join(__dirname,"xdg-open"),{platform:A,arch:z}=process,gt=()=>{try{return D.statSync("/run/.containerenv"),!0}catch{return!1}},_;function wt(){return _===void 0&&(_=gt()||ht()),_}var kt=(()=>{let t="/mnt/",e;return async function(){if(e)return e;let r="/etc/wsl.conf",a=!1;try{await D.access(r,J.F_OK),a=!0}catch{}if(!a)return t;let o=await D.readFile(r,{encoding:"utf8"}),f=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(o);return f?(e=f.groups.mountPoint.trim(),e=e.endsWith("/")?e:`${e}/`,e):t}})(),V=async(t,e)=>{let r;for(let a of t)try{return await e(a)}catch(o){r=o}throw r},P=async t=>{if(t={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...t},Array.isArray(t.app))return V(t.app,u=>P({...t,app:u}));let{name:e,arguments:r=[]}=t.app||{};if(r=[...r],Array.isArray(e))return V(e,u=>P({...t,app:{name:u,arguments:r}}));let a,o=[],f={};if(A==="darwin")a="open",t.wait&&o.push("--wait-apps"),t.background&&o.push("--background"),t.newInstance&&o.push("--new"),e&&o.push("-a",e);else if(A==="win32"||k&&!wt()&&!e){let u=await kt();a=k?`${u}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,o.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),k||(f.windowsVerbatimArguments=!0);let s=["Start"];t.wait&&s.push("-Wait"),e?(s.push(`"\`"${e}\`""`,"-ArgumentList"),t.target&&r.unshift(t.target)):t.target&&s.push(`"${t.target}"`),r.length>0&&(r=r.map(m=>`"\`"${m}\`""`),s.push(r.join(","))),t.target=Buffer.from(s.join(" "),"utf16le").toString("base64")}else{if(e)a=e;else{let u=!__dirname||__dirname==="/",s=!1;try{await D.access(X,J.X_OK),s=!0}catch{}a=process.versions.electron||A==="android"||u||!s?"xdg-open":X}r.length>0&&o.push(...r),t.wait||(f.stdio="ignore",f.detached=!0)}t.target&&o.push(t.target),A==="darwin"&&r.length>0&&o.push("--args",...r);let p=At.spawn(a,o,f);return t.wait?new Promise((u,s)=>{p.once("error",s),p.once("close",m=>{if(!t.allowNonzeroExitCode&&m>0){s(new Error(`Exited with code ${m}`));return}u(p)})}):(p.unref(),p)},N=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `target`");return P({...e,target:t})},Dt=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `name`");let{arguments:r=[]}=e||{};if(r!=null&&!Array.isArray(r))throw new TypeError("Expected `appArguments` as Array type");return P({...e,app:{name:t,arguments:r}})};function H(t){if(typeof t=="string"||Array.isArray(t))return t;let{[z]:e}=t;if(!e)throw new Error(`${z} is not supported`);return e}function I({[A]:t},{wsl:e}){if(e&&k)return H(e);if(!t)throw new Error(`${A} is not supported`);return H(t)}var C={};T(C,"chrome",()=>I({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));T(C,"firefox",()=>I({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));T(C,"edge",()=>I({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));N.apps=C;N.openApp=Dt;Y.exports=N});var Et={};st(Et,{default:()=>et});module.exports=lt(Et);var n=require("@raycast/api"),F=require("react"),tt=U(R()),v=require("@raycast/api");var j=U(R()),x=class{constructor(e){this.callbackParams=[];this.baseUrl=e}getBaseUrl(){return this.baseUrl}getParams(){return this.callbackParams}addParam(e){this.callbackParams.push(e)}createCallbackUrl(){let e=0,r=this.baseUrl;return this.callbackParams.forEach(function(a){r=r+(e==0?"":"&")+a.name+"="+encodeURIComponent(a.value),e=e+1}),r}async openCallbackUrl(){await(0,j.default)(this.createCallbackUrl())}};var y={CREATE_DRAFT:"drafts://x-callback-url/create?",OPEN_DRAFT:"drafts://x-callback-url/open?",RUN_ACTION:"drafts://x-callback-url/runAction?",OPEN_WORKSPACE:"drafts://x-callback-url/workspace?",APPEND_TO_DRAFT:"drafts://x-callback-url/append?",PREPEND_TO_DRAFT:"drafts://x-callback-url/prepend?",DICTATE:"drafts://x-callback-url/dictate?"};var h={APP_NAME:"Drafts",APP_BUNDLE_ID:"com.agiletortoise.Drafts-OSX",APP_DOWNLOAD_LINK:"https://getdrafts.com"};var d=require("@raycast/api");async function Pt(){return(await(0,d.getApplications)()).some(({bundleId:e})=>e===h.APP_BUNDLE_ID)}async function Z(){if(!await Pt()){let t={style:d.Toast.Style.Failure,title:h.APP_NAME+" is not installed.",message:"Install it from: "+h.APP_DOWNLOAD_LINK,primaryAction:{title:"Open "+h.APP_DOWNLOAD_LINK,onAction:e=>{(0,d.open)(h.APP_DOWNLOAD_LINK),e.hide()}}};return await(0,d.showToast)(t),!1}return!0}var i=require("react/jsx-runtime"),L=n.Toast.Style;function O(t){return(0,i.jsx)(n.Action.Push,{icon:n.Icon.Plus,title:"Add Action",shortcut:{modifiers:["opt"],key:"a"},target:(0,i.jsx)(bt,{onCreate:t.onCreate})})}function Ct(t){return(0,i.jsx)(n.Action,{icon:n.Icon.ArrowRight,title:"Run Action without Input",onAction:t.onOpen})}function xt(t){async function e(r){let a=new x(y.CREATE_DRAFT);a.addParam({name:"text",value:r.content}),a.addParam({name:"action",value:t.actionName}),a.openCallbackUrl(),await(0,n.popToRoot)({clearSearchBar:!0}),await(0,n.closeMainWindow)()}return(0,i.jsx)(n.Form,{actions:(0,i.jsx)(n.ActionPanel,{children:(0,i.jsx)(n.Action.SubmitForm,{onSubmit:e,title:"Run Action"})}),children:(0,i.jsx)(n.Form.TextArea,{id:"content",title:"Input",placeholder:"Enter input for Action",defaultValue:"",autoFocus:!0})})}function yt(t){return(0,i.jsx)(n.Action,{icon:n.Icon.Trash,title:"Remove Action",shortcut:{modifiers:["opt"],key:"d"},onAction:t.onDelete})}function bt(t){let{pop:e}=(0,n.useNavigation)();async function r(a){a.actionName.length>0?(t.onCreate({actionName:a.actionName,requiresInput:a.requiresInput}),e()):await(0,n.showToast)({style:L.Failure,title:"Action Name must not be empty!"})}return(0,i.jsxs)(n.Form,{actions:(0,i.jsx)(n.ActionPanel,{children:(0,i.jsx)(n.Action.SubmitForm,{title:"Add Action",onSubmit:r})}),children:[(0,i.jsx)(n.Form.TextField,{id:"actionName",title:"Add Action"}),(0,i.jsx)(n.Form.Checkbox,{id:"requiresInput",title:"ask for input",defaultValue:!0,label:"if checked the action will ask for a text input when you run it"})]})}function et(){Z();let[t,e]=(0,F.useState)([]),[r,a]=(0,F.useState)(!0);async function o(){let c=await v.LocalStorage.getItem("stored-actions");if(c){let l=JSON.parse(c);e(l)}a(!1)}async function f(c){let l=JSON.stringify(c);await v.LocalStorage.setItem("stored-actions",l),o()}t.length==0&&o();async function p(c){let l=[...t,c];f(l),e(l),await(0,n.showToast)({style:L.Success,title:'Added Action "'+c.actionName+'"'})}async function u(c){(0,tt.default)("drafts://x-callback-url/runAction?text=&action="+c.actionName),await(0,n.popToRoot)({clearSearchBar:!0}),await(0,n.closeMainWindow)()}async function s(c){let l=[...t];l.splice(c,1),f(l),e(l),await(0,n.showToast)({style:L.Success,title:"Removed Action"})}function m(c){return c.requiresInput?(0,i.jsx)(n.Action.Push,{title:"Run Action with Input",target:(0,i.jsx)(xt,{actionName:c.actionName,requiresInput:!0})}):(0,i.jsx)(Ct,{onOpen:()=>u(c)})}function nt(c){return c.requiresInput?(0,i.jsx)(n.Action.CreateQuicklink,{quicklink:{link:y.RUN_ACTION+"action="+encodeURIComponent(c.actionName)+"&text={text}"},icon:n.Icon.Link,title:'Create Quicklink to run Action "'+c.actionName+'"'}):(0,i.jsx)(n.Action.CreateQuicklink,{quicklink:{link:y.RUN_ACTION+"action="+encodeURIComponent(c.actionName)},icon:n.Icon.Link,title:'Create Quicklink to run Action "'+c.actionName+'"'})}return(0,i.jsxs)(n.List,{navigationTitle:"Search Drafts Actions",searchBarPlaceholder:"Search Drafts Actions you want to run",actions:(0,i.jsx)(n.ActionPanel,{children:(0,i.jsx)(O,{onCreate:p})}),isLoading:r,children:[(0,i.jsx)(n.List.EmptyView,{actions:(0,i.jsx)(n.ActionPanel,{children:(0,i.jsx)(O,{onCreate:p})}),title:"No (matching) Actions Configured!",description:"Configure Actions you want to run from Raycast",icon:"\u2699\uFE0F"}),(0,i.jsx)(n.List.Item,{title:"Deprecated Command",subtitle:"Please use the Command 'Find Drafts Action' or 'Find Latest Drafts Action' instead.",icon:n.Icon.Warning}),t.map((c,l)=>(0,i.jsx)(n.List.Item,{title:c.actionName,icon:n.Icon.List,actions:(0,i.jsxs)(n.ActionPanel,{children:[(0,i.jsxs)(n.ActionPanel.Section,{children:[m(c),nt(c),(0,i.jsx)(yt,{onDelete:()=>s(l)})]}),(0,i.jsx)(O,{onCreate:p})]})},l))]})}
