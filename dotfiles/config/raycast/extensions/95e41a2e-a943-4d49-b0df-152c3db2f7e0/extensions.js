"use strict";var Ce=Object.create;var O=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Te=Object.prototype.hasOwnProperty;var Ue=(t,e)=>{for(var r in e)O(t,r,{get:e[r],enumerable:!0})},re=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Re(e))!Te.call(t,s)&&s!==r&&O(t,s,{get:()=>e[s],enumerable:!(n=Ie(e,s))||n.enumerable});return t};var w=(t,e,r)=>(r=t!=null?Ce(Pe(t)):{},re(e||!t||!t.__esModule?O(r,"default",{value:t,enumerable:!0}):r,t)),_e=t=>re(O({},"__esModule",{value:!0}),t);var Ge={};Ue(Ge,{default:()=>ye,useLocalExtensions:()=>$e});module.exports=_e(Ge);var d=require("@raycast/api"),R=require("react");var f=require("@raycast/api");var c=w(require("react")),o=require("@raycast/api");var ne=Object.prototype.hasOwnProperty;function D(t,e){var r,n;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((n=t.length)===e.length)for(;n--&&D(t[n],e[n]););return n===-1}if(!r||typeof t=="object"){n=0;for(r in t)if(ne.call(t,r)&&++n&&!ne.call(e,r)||!(r in e)||!D(t[r],e[r]))return!1;return Object.keys(e).length===n}}return t!==t&&e!==e}var C=w(require("node:fs")),L=w(require("node:path"));var se=require("react/jsx-runtime");function Oe(t){let e=(0,c.useRef)(t),r=(0,c.useRef)(0);return D(t,e.current)||(e.current=t,r.current+=1),(0,c.useMemo)(()=>e.current,[r.current])}function k(t){let e=(0,c.useRef)(t);return e.current=t,e}function De(t,e){let r=t instanceof Error?t.message:String(t);return(0,o.showToast)({style:o.Toast.Style.Failure,title:e?.title??"Something went wrong",message:e?.message??r,primaryAction:e?.primaryAction??ae(t),secondaryAction:e?.primaryAction?ae(t):void 0})}var ae=t=>{let e=!0,r="[Extension Name]...",n="";try{let l=JSON.parse((0,C.readFileSync)((0,L.join)(o.environment.assetsPath,"..","package.json"),"utf8"));r=`[${l.title}]...`,n=`https://raycast.com/${l.owner||l.author}/${l.name}`,(!l.owner||l.access==="public")&&(e=!1)}catch{}let s=o.environment.isDevelopment||e,a=t instanceof Error?t?.stack||t?.message||"":String(t);return{title:s?"Copy Logs":"Report Error",onAction(l){l.hide(),s?o.Clipboard.copy(a):(0,o.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${a}
\`\`\`
`)}`)}}};function ie(t,e,r){let n=(0,c.useRef)(0),[s,a]=(0,c.useState)({isLoading:!0}),l=k(t),m=k(r?.abortable),p=k(e||[]),b=k(r?.onError),$=k(r?.onData),v=k(r?.onWillExecute),P=k(r?.failureToastOptions),ee=k(s.data),J=(0,c.useRef)(null),y=(0,c.useRef)({page:0}),H=(0,c.useRef)(!1),Z=(0,c.useRef)(!0),te=(0,c.useRef)(50),S=(0,c.useCallback)(()=>(m.current&&(m.current.current?.abort(),m.current.current=new AbortController),++n.current),[m]),E=(0,c.useCallback)((...x)=>{let g=S();v.current?.(x),a(i=>({...i,isLoading:!0}));let T=Le(l.current)(...x);function U(i){return i.name=="AbortError"||g===n.current&&(b.current?b.current(i):o.environment.launchType!==o.LaunchType.Background&&De(i,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(A){A.hide(),J.current?.(...p.current||[])}},...P.current}),a({error:i,isLoading:!1})),i}return typeof T=="function"?(H.current=!0,T(y.current).then(({data:i,hasMore:A,cursor:Ee})=>(g===n.current&&(y.current&&(y.current.cursor=Ee,y.current.lastItem=i?.[i.length-1]),$.current&&$.current(i,y.current),A&&(te.current=i.length),Z.current=A,a(Ae=>y.current.page===0?{data:i,isLoading:!1}:{data:(Ae.data||[])?.concat(i),isLoading:!1})),i),i=>(Z.current=!1,U(i)))):(H.current=!1,T.then(i=>(g===n.current&&($.current&&$.current(i),a({data:i,isLoading:!1})),i),U))},[$,b,p,l,a,J,v,y,P,S]);J.current=E;let _=(0,c.useCallback)(()=>{y.current={page:0};let x=p.current||[];return E(...x)},[E,p]),we=(0,c.useCallback)(async(x,g)=>{let T;try{if(g?.optimisticUpdate){S(),typeof g?.rollbackOnError!="function"&&g?.rollbackOnError!==!1&&(T=structuredClone(ee.current?.value));let U=g.optimisticUpdate;a(i=>({...i,data:U(i.data)}))}return await x}catch(U){if(typeof g?.rollbackOnError=="function"){let i=g.rollbackOnError;a(A=>({...A,data:i(A.data)}))}else g?.optimisticUpdate&&g?.rollbackOnError!==!1&&a(i=>({...i,data:T}));throw U}finally{g?.shouldRevalidateAfter!==!1&&(o.environment.launchType===o.LaunchType.Background||o.environment.commandMode==="menu-bar"?await _():_())}},[_,ee,a,S]),xe=(0,c.useCallback)(()=>{y.current.page+=1;let x=p.current||[];E(...x)},[y,p,E]);(0,c.useEffect)(()=>{y.current={page:0},r?.execute!==!1?E(...e||[]):S()},[Oe([e,r?.execute,E]),m,y]),(0,c.useEffect)(()=>()=>{S()},[S]);let ke=r?.execute!==!1?s.isLoading:!1,ve={...s,isLoading:ke},Se=H.current?{pageSize:te.current,hasMore:Z.current,onLoadMore:xe}:void 0;return{...ve,revalidate:_,mutate:we,pagination:Se}}function Le(t){return t===Promise.all||t===Promise.race||t===Promise.resolve||t===Promise.reject?t.bind(Promise):t}var B=require("@raycast/api"),Y=w(require("child_process")),z=w(require("fs/promises")),Q=w(require("os")),u=w(require("path"));var Ne=require("@raycast/api"),N=w(require("fs"));function V(t){return t instanceof Error?t.message:"unknown error"}async function F(t){return N.promises.access(t,N.constants.F_OK).then(()=>!0).catch(()=>!1)}var Ye=new Intl.NumberFormat("en",{notation:"compact"});var q=process.platform==="win32",W=process.platform==="darwin";var ce=require("@raycast/api");function oe(t,e){let r,n;function s(...a){return(r===void 0||e?.maxAge&&n!==void 0&&Date.now()-n>e.maxAge)&&(r=t(...a),n=Date.now()),r}return s.clear=()=>{r=void 0,n=void 0},s}var le=w(require("path")),Ve=oe(ce.getApplications),Fe={Antigravity:{macos:"com.google.antigravity",windows:{name:"Antigravity",exe:"Antigravity.exe"}},Code:{macos:"com.microsoft.VSCode",windows:{name:"Visual Studio Code",exe:"Code.exe"}},"Code - Insiders":{macos:"com.microsoft.VSCodeInsiders",windows:{name:"Visual Studio Code - Insiders",exe:"Code - Insiders.exe"}},Cursor:{macos:"com.todesktop.230313mzl4w4u92",windows:{name:"Cursor",exe:"Cursor.exe"}},Kiro:{macos:"dev.kiro.desktop",windows:{name:"Kiro",exe:"Kiro.exe"}},Positron:{macos:"com.rstudio.positron",windows:{name:"Positron",exe:"Positron.exe"}},Trae:{macos:"com.trae.app",windows:{name:"Trae",exe:"Trae.exe"}},"Trae CN":{macos:"cn.trae.app",windows:{name:"Trae CN",exe:"Trae - CN.exe"}},VSCodium:{macos:"com.vscodium",windows:{name:"VSCodium",exe:"VSCodium.exe"}},"VSCodium - Insiders":{macos:"com.vscodium.VSCodiumInsiders",windows:{name:"VSCodium - Insiders",exe:"VSCodium - Insiders.exe"}},Windsurf:{macos:"com.exafunction.windsurf",windows:{name:"Windsurf",exe:"Windsurf.exe"}}};async function j(t){let e=await Ve(),r=Fe[t];if(W){if(r){let n=e.find(s=>s.bundleId===r.macos);if(n)return n}}else{let n=e.find(s=>{let a=s.name===r.windows.name,m=le.default.basename(s.path)===r.windows.exe;return a||m});if(n)return n}}var ue=require("@raycast/api"),I=(0,ue.getPreferenceValues)(),fe=I.build,at=I.layout,st=I.keepSectionOrder,it=I.closeOtherWindows,ot=I.terminalApp,ct=I.showGitBranch,lt=I.gitBranchColor;function We(t){if(!t)return t;let e=t.match(/%(.+)%/);if(e)return e[1]}function Me(){let t={};if(q){let e=u.default.join(Q.homedir(),"AppData","Local","Programs");t={Antigravity:u.default.join(e,"Antigravity","bin","antigravity.cmd"),Code:u.default.join(e,"Microsoft VS Code","bin","code.cmd"),"Code - Insiders":u.default.join(e,"Microsoft VS Code Insiders","bin","code-insiders.cmd"),Kiro:u.default.join(e,"Kiro","bin","kiro.cmd"),Cursor:u.default.join(e,"cursor","resources","app","bin","cursor.cmd"),Positron:u.default.join(e,"Positron","bin","positron.cmd"),Trae:u.default.join(e,"Trae","bin","trae.cmd"),"Trae CN":u.default.join(e,"Trae CN","bin","trae-cn.cmd"),VSCodium:u.default.join(e,"VSCodium","bin","codium.cmd"),"VSCodium - Insiders":u.default.join(e,"VSCodium Insiders","bin","codium-insiders.cmd"),Windsurf:u.default.join(e,"Windsurf","bin","windsurf.cmd")}}return W&&(t={Antigravity:"/Applications/Antigravity.app/Contents/Resources/app/bin/antigravity",Code:"/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code","Code - Insiders":"/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/bin/code",Cursor:"/Applications/Cursor.app/Contents/Resources/app/bin/cursor",Kiro:"/Applications/Kiro.app/Contents/Resources/app/bin/kiro",Positron:"/Applications/Positron.app/Contents/Resources/app/bin/code",Trae:"/Applications/Trae.app/Contents/Resources/app/bin/marscode","Trae CN":"/Applications/Trae CN.app/Contents/Resources/app/bin/marscode",VSCodium:"/Applications/VSCodium.app/Contents/Resources/app/bin/codium","VSCodium - Insiders":"/Applications/VSCodium - Insiders.app/Contents/Resources/app/bin/codium-insiders",Windsurf:"/Applications/Windsurf.app/Contents/Resources/app/bin/windsurf"}),t}function je(){let t=Me(),e=t[G()];return!e||e.length<=0?t.Code:e}var X=class{constructor(e){this.cliFilename=`"${e}"`,this.execOptions=q?{shell:!0}:void 0}installExtensionByIDSync(e){Y.execFileSync(this.cliFilename,["--install-extension",e,"--force"],this.execOptions)}uninstallExtensionByIDSync(e){Y.execFileSync(this.cliFilename,["--uninstall-extension",e,"--force"],this.execOptions)}async newWindow(){let e=await j(fe);(0,B.open)("",e)}};function he(){return new X(je())}async function ze(t){try{if(await F(t)){let e=await z.readFile(t,{encoding:"utf-8"}),r=JSON.parse(e),n=r.displayName,s=We(n),a=r.icon,l=u.default.dirname(t);if(s&&s.length>0){let b=u.default.join(l,"package.nls.json");try{if(await F(b)){let $=await z.readFile(b,{encoding:"utf-8"}),P=JSON.parse($)[s];P&&P.length>0&&(n=P)}}catch{}}let m=r.preview,p=a?u.default.join(l,a):void 0;return{displayName:n,icon:p,preview:m}}}catch{}}async function pe(){let t=u.default.join(Q.homedir(),`.${M()}/extensions`),e=u.default.join(t,"extensions.json");if(await F(e)){let r=await z.readFile(e,{encoding:"utf-8"}),n=JSON.parse(r);if(n&&n.length>0){let s=[];for(let a of n){let l=typeof a.location=="string"?u.default.join(t,a.location):a.location.fsPath??a.location.path,m=u.default.join(l,"package.json"),p=await ze(m);s.push({id:a.identifier.id,name:p?.displayName||a.identifier.id,version:a.version,preRelease:a.metadata?.preRelease,icon:p?.icon,updated:a.metadata?.updated,fsPath:l,publisherId:a.metadata?.publisherId,publisherDisplayName:a.metadata?.publisherDisplayName,preview:p?.preview,installedTimestamp:a.metadata?.installedTimestamp})}return s}}}function G(){return(0,B.getPreferenceValues)().build}var de={Antigravity:"antigravity",Code:"vscode","Code - Insiders":"vscode-insiders",Cursor:"cursor",Kiro:"kiro",VSCodium:"vscode-oss",Positron:"positron",Windsurf:"windsurf",Trae:"trae","Trae CN":"trae-cn"};function M(){let t=de[G()];return!t||t.length<=0?de.Code:t}var K=require("react/jsx-runtime");function me(t){return(0,K.jsx)(f.Action,{onAction:async()=>{try{await(0,f.confirmAlert)({title:t.extensionName?`Uninstall "${t.extensionName}" extension?`:"Uninstall extension?",icon:f.Icon.Trash,primaryAction:{style:f.Alert.ActionStyle.Destructive,title:"Uninstall"}})&&(await(0,f.showToast)({style:f.Toast.Style.Animated,title:"Uninstall Extension"}),he().uninstallExtensionByIDSync(t.extensionID),await(0,f.showToast)({style:f.Toast.Style.Success,title:"Uninstall Successful"}),t.afterUninstall&&t.afterUninstall())}catch(r){(0,f.showToast)({style:f.Toast.Style.Failure,title:"Error",message:V(r)})}},title:"Uninstall Extension",style:f.Action.Style.Destructive,icon:f.Icon.Trash,shortcut:{modifiers:["ctrl"],key:"x"}})}function ge(t){let e=G(),{data:r}=ie(async()=>j(e)),n=`${M()}:extension/${t.extensionID}`,s=`Open in ${e}`;return(0,K.jsx)(f.Action.OpenInBrowser,{title:s,url:n,icon:r?{fileIcon:r.path}:"icon.png"})}function be(t){let e=`https://marketplace.visualstudio.com/items?itemName=${t.extensionID}`;return(0,K.jsx)(f.Action.OpenInBrowser,{title:"Open in Browser",url:e,shortcut:{modifiers:["cmd"],key:"b"}})}var h=require("react/jsx-runtime");function Be(t){let e=t.extension;return(0,h.jsx)(d.List.Item,{title:e.name,subtitle:e.publisherDisplayName,icon:{source:e.icon||"icon.png",fallback:"icon.png"},accessories:[{tag:e.preview===!0?{color:d.Color.Red,value:"Preview"}:""},{tag:e.version,tooltip:e.installedTimestamp?`Installed:  ${new Date(e.installedTimestamp).toLocaleString()}`:""}],actions:(0,h.jsxs)(d.ActionPanel,{children:[(0,h.jsxs)(d.ActionPanel.Section,{children:[(0,h.jsx)(ge,{extensionID:e.id}),(0,h.jsx)(be,{extensionID:e.id})]}),(0,h.jsxs)(d.ActionPanel.Section,{children:[(0,h.jsx)(d.Action.CopyToClipboard,{content:e.id,title:"Copy Extension ID",shortcut:{modifiers:["cmd","shift"],key:"."}}),e.publisherDisplayName&&(0,h.jsx)(d.Action.CopyToClipboard,{content:e.publisherDisplayName,title:"Copy Publisher Name",shortcut:{modifiers:["cmd","shift"],key:","}}),(0,h.jsx)(d.Action.Open,{title:"Open in Finder",target:e.fsPath,shortcut:{modifiers:["cmd","shift"],key:"f"}})]}),(0,h.jsx)(d.ActionPanel.Section,{children:(0,h.jsx)(me,{extensionID:e.id,extensionName:e.name,afterUninstall:t.reloadExtension})})]})})}function ye(){let{extensions:t,isLoading:e,error:r,refresh:n}=$e();r&&(0,d.showToast)({style:d.Toast.Style.Failure,title:"Error",message:r});let s=t?.sort((a,l)=>a.name<l.name?-1:a.name>l.name?1:0);return(0,h.jsx)(d.List,{isLoading:e,searchBarPlaceholder:"Search Installed Extensions",children:(0,h.jsx)(d.List.Section,{title:"Installed Extensions",subtitle:`${s?.length}`,children:s?.map(a=>(0,h.jsx)(Be,{extension:a,reloadExtension:n},`${a.id}-${a.version}`))})})}function $e(){let[t,e]=(0,R.useState)(!0),[r,n]=(0,R.useState)(),[s,a]=(0,R.useState)(),[l,m]=(0,R.useState)(new Date),p=()=>{m(new Date)};return(0,R.useEffect)(()=>{let b=!1;async function $(){if(!b){e(!0),a(void 0);try{let v=await pe();b||n(v)}catch(v){b||a(V(v))}finally{b||e(!1)}}}return $(),()=>{b=!0}},[l]),{extensions:r,isLoading:t,error:s,refresh:p}}0&&(module.exports={useLocalExtensions});
