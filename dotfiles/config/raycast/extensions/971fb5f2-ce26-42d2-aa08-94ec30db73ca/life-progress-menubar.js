"use strict";var Se=Object.create;var j=Object.defineProperty;var Ee=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var _e=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var De=(e,t)=>{for(var r in t)j(e,r,{get:t[r],enumerable:!0})},te=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Te(t))!Ae.call(e,a)&&a!==r&&j(e,a,{get:()=>t[a],enumerable:!(n=Ee(t,a))||n.enumerable});return e};var Z=(e,t,r)=>(r=e!=null?Se(_e(e)):{},te(t||!e||!e.__esModule?j(r,"default",{value:e,enumerable:!0}):r,e)),Ue=e=>te(j({},"__esModule",{value:!0}),e);var tt={};De(tt,{default:()=>we});module.exports=Ue(tt);var p=require("@raycast/api"),J=require("react");var q=require("@raycast/api"),{weekStart:B,birthday:Y,progressSymbol:re,showProgressBar:nt,countdownDateFirst:at}=(0,q.getPreferenceValues)(),{colorIcon:X,showTitle:ne,commandMetadata:ae,hour24:se}=(0,q.getPreferenceValues)();var T=require("@raycast/api");var u=Z(require("react")),c=require("@raycast/api");var ie=Object.prototype.hasOwnProperty;function G(e,t){var r,n;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&G(e[n],t[n]););return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(ie.call(e,r)&&++n&&!ie.call(t,r)||!(r in t)||!G(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}var I=Z(require("node:fs")),H=Z(require("node:path"));var ue=require("react/jsx-runtime");function Ce(e){let t=(0,u.useRef)(e),r=(0,u.useRef)(0);return G(e,t.current)||(t.current=e,r.current+=1),(0,u.useMemo)(()=>t.current,[r.current])}function U(e){let t=(0,u.useRef)(e);return t.current=e,t}function Pe(e,t){let r=e instanceof Error?e.message:String(e);return(0,c.showToast)({style:c.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??oe(e),secondaryAction:t?.primaryAction?oe(e):void 0})}var oe=e=>{let t=!0,r="[Extension Name]...",n="";try{let i=JSON.parse((0,I.readFileSync)((0,H.join)(c.environment.assetsPath,"..","package.json"),"utf8"));r=`[${i.title}]...`,n=`https://raycast.com/${i.owner||i.author}/${i.name}`,(!i.owner||i.access==="public")&&(t=!1)}catch{}let a=c.environment.isDevelopment||t,s=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(i){i.hide(),a?c.Clipboard.copy(s):(0,c.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${s}
\`\`\`
`)}`)}}};function le(e,t,r){let n=(0,u.useRef)(0),[a,s]=(0,u.useState)({isLoading:!0}),i=U(e),h=U(r?.abortable),f=U(t||[]),v=U(r?.onError),g=U(r?.onData),S=U(r?.onWillExecute),w=U(r?.failureToastOptions),A=U(a.data),$=(0,u.useRef)(null),d=(0,u.useRef)({page:0}),M=(0,u.useRef)(!1),E=(0,u.useRef)(!0),F=(0,u.useRef)(50),k=(0,u.useCallback)(()=>(h.current&&(h.current.current?.abort(),h.current.current=new AbortController),++n.current),[h]),m=(0,u.useCallback)((...D)=>{let b=k();S.current?.(D),s(o=>({...o,isLoading:!0}));let W=Re(i.current)(...D);function N(o){return o.name=="AbortError"||b===n.current&&(v.current?v.current(o):c.environment.launchType!==c.LaunchType.Background&&Pe(o,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(R){R.hide(),$.current?.(...f.current||[])}},...w.current}),s({error:o,isLoading:!1})),o}return typeof W=="function"?(M.current=!0,W(d.current).then(({data:o,hasMore:R,cursor:xe})=>(b===n.current&&(d.current&&(d.current.cursor=xe,d.current.lastItem=o?.[o.length-1]),g.current&&g.current(o,d.current),R&&(F.current=o.length),E.current=R,s(ve=>d.current.page===0?{data:o,isLoading:!1}:{data:(ve.data||[])?.concat(o),isLoading:!1})),o),o=>(E.current=!1,N(o)))):(M.current=!1,W.then(o=>(b===n.current&&(g.current&&g.current(o),s({data:o,isLoading:!1})),o),N))},[g,v,f,i,s,$,S,d,w,k]);$.current=m;let P=(0,u.useCallback)(()=>{d.current={page:0};let D=f.current||[];return m(...D)},[m,f]),V=(0,u.useCallback)(async(D,b)=>{let W;try{if(b?.optimisticUpdate){k(),typeof b?.rollbackOnError!="function"&&b?.rollbackOnError!==!1&&(W=structuredClone(A.current?.value));let N=b.optimisticUpdate;s(o=>({...o,data:N(o.data)}))}return await D}catch(N){if(typeof b?.rollbackOnError=="function"){let o=b.rollbackOnError;s(R=>({...R,data:o(R.data)}))}else b?.optimisticUpdate&&b?.rollbackOnError!==!1&&s(o=>({...o,data:W}));throw N}finally{b?.shouldRevalidateAfter!==!1&&(c.environment.launchType===c.LaunchType.Background||c.environment.commandMode==="menu-bar"?await P():P())}},[P,A,s,k]),x=(0,u.useCallback)(()=>{d.current.page+=1;let D=f.current||[];m(...D)},[d,f,m]);(0,u.useEffect)(()=>{d.current={page:0},r?.execute!==!1?m(...t||[]):k()},[Ce([t,r?.execute,m]),h,d]),(0,u.useEffect)(()=>()=>{k()},[k]);let z=r?.execute!==!1?a.isLoading:!1,L={...a,isLoading:z},ke=M.current?{pageSize:F.current,hasMore:E.current,onLoadMore:x}:void 0;return{...L,revalidate:P,mutate:V,pagination:ke}}function Re(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ce(e,t,r,n){let a=(n-90)*Math.PI/180;return{x:e+r*Math.cos(a),y:t+r*Math.sin(a)}}function Ie(e,t,r,n,a){let s=ce(e,t,r,a),i=ce(e,t,r,n),h=a-n<=180?"0":"1";return["M",s.x,s.y,"A",r,r,0,h,0,i.x,i.y].join(" ")}function Q(e,t=c.Color.Red,r){let n=r?.background||(c.environment.appearance==="light"?"black":"white"),a=r?.backgroundOpacity||.1,s=10,h=50-5-s/2,f=`<svg xmlns="http://www.w3.org/2000/svg" width="100px" height="100px">
      <circle cx="50" cy="50" r="${h}" stroke-width="${s}" stroke="${e<1?n:t}" opacity="${e<1?a:"1"}" fill="none" />
      ${e>0&&e<1?`<path d="${Ie(50,50,h,0,e*360)}" stroke="${t}" stroke-width="${s}" fill="none" />`:""}
    </svg>
  `.replaceAll(`
`,"");return`data:image/svg+xml,${encodeURIComponent(f)}`}var Oe=()=>{let e="\u25A0",t="\u25A1";switch(re){case"\u25A0":{e="\u25A0",t="\u25A1";break}case"\u25CF":{e="\u25CF",t="\u25CB";break}case"\u2665\uFE0E":{e="\u2665\uFE0E\uFE0E",t="\u2661";break}case"\u273F":{e="\u273F\uFE0E",t="\u2740";break}case"\u2605":{e="\u2605",t="\u2606";break}case"\u272A":{e="\u272A",t="\u25CB";break}default:break}return{spentSymbol:e,leftSymbol:t}},l=(e,t,r)=>{let{spentSymbol:n,leftSymbol:a}=Oe(),s=n.repeat(Math.floor(e/(e+t)*r))+a.repeat(r-Math.floor(e/(e+t)*r)),i=(e/(e+t)*100).toFixed(0)+"%";return{canvas:s,text:i}};var K=e=>{let t=r=>r<.1?T.Color.Purple:r<.35?T.Color.Blue:r<.5?T.Color.Green:r<.65?T.Color.Yellow:r<.8?T.Color.Orange:r<.95?T.Color.Magenta:T.Color.Red;return{source:{light:Q(e,X?t(e):"#000000",{background:"#000000",backgroundOpacity:.15}),dark:Q(e,X?t(e):"#ffffff",{background:"#ffffff",backgroundOpacity:.25})}}},fe=e=>{if(!e||e.length===0)return;let t=[],r,n=24-e[6].number-1,a={icon:K(n/24),progress:n+"/24",title:"Hour of Day"},{daysLeftInWeek:s}=Me(B),i=7-s,h={icon:K(i/7),progress:i+"/7",title:"Day of Week"},f=Le(),v=f-e[8].number,g={icon:K(v/f),progress:v+"/"+f,title:"Day of Month"},S=Ne(),w=S-e[9].number,A={icon:K(w/S),progress:w+"/"+S,title:"Day of Year"};switch(t.push(a),t.push(h),t.push(g),t.push(A),ae){case"Day":{r=a;break}case"Week":{r=h;break}case"Month":{r=g;break}case"Year":{r=A;break}}return ne||(r.title=""),{menuBarInfo:r,progressList:t}};function Me(e="Monday"){let t={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error("Invalid week start day. It should be one of 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'.");let n=new Date().getDay(),a=t[e],s=(n-a+7)%7+1,i=6-s+1;return{daysSinceWeekStart:s,daysLeftInWeek:i}}var Le=()=>{let e=new Date,t=e.getFullYear(),r=e.getMonth(),n=new Date(t,r+1,1);return new Date(n.getTime()-24*60*60*1e3).getDate()},We=e=>e%4===0&&e%100!==0||e%400===0,Ne=()=>{let t=new Date().getFullYear();return We(t)?366:365},de=()=>{let e=new Date;if(se){let t=e.getHours().toString().padStart(2,"0"),r=e.getMinutes().toString().padStart(2,"0");return`${t}:${r}`}else{let t=e.getHours()%12||12,r=e.getMinutes().toString().padStart(2,"0"),n=e.getHours()>=12?"PM":"AM";return`${t}:${r} ${n}`}},he=()=>{let e=new Date;return new Intl.DateTimeFormat("en-US",{weekday:"short"}).format(e)+" "+Fe()},Fe=()=>{let e=new Date;return`${new Intl.DateTimeFormat("en-US",{month:"short"}).format(e)} ${e.getDate()} ${e.getFullYear()}`};var ye=require("@raycast/api");var Ve=["Countdown Date","You have","You may be able to"],ze=["You have","You may be able to","Countdown Date"],dt=["All"].concat(Ve),ht=["All"].concat(ze);var je=()=>{let e=new Date;return new Date(Y).getTime()>e.getTime()?{isValid:!1,birthTime:new Date("1995-01-01")}:new Date(Y).getTime()<new Date(`${e.getFullYear()-110}-01-01`).getTime()?{isValid:!1,birthTime:new Date("1995-01-01")}:{isValid:!0,birthTime:new Date(Y)}};var C=je().birthTime,ee=new Date(C.getFullYear()+80,C.getMonth(),C.getDate()),O=new Date,pe=()=>Math.floor(O.getFullYear()-C.getFullYear()),me=()=>Math.floor((O.getTime()-C.getTime())/(1e3*60*60*24)),Be=()=>C.getFullYear()>=2e3?1:2,ge=()=>{let e=ee.getTime()-O.getTime();return Math.floor(e/(1e3*60*60*24))},Ye=()=>({spentPaychecks:(O.getFullYear()-C.getFullYear())*12+O.getMonth()-C.getMonth(),leftPaychecks:(ee.getFullYear()-O.getFullYear())*12+ee.getMonth()-O.getMonth()}),Ge=()=>({spentWeeks:Math.floor(me()/7),leftWeeks:Math.floor(ge()/7)}),He=()=>24-new Date().getHours()-1,Ke=()=>{let e=new Date;switch(B){case"Sunday":return 6-e.getDay();case"Monday":return e.getDay()===0?0:7-e.getDay();case"Tuesday":return e.getDay()<=1?1-e.getDay():8-e.getDay();case"Wednesday":return e.getDay()<=2?2-e.getDay():9-e.getDay();case"Thursday":return e.getDay()<=3?3-e.getDay():10-e.getDay();case"Friday":return e.getDay()<=4?4-e.getDay():11-e.getDay();case"Saturday":return e.getDay()<=5?5-e.getDay():12-e.getDay();default:return 6-e.getDay()}},Je=()=>{let e=new Date,t=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();return{spentMonth:e.getDate(),leftMonth:t-e.getDate(),allMonth:t}},Ze=()=>{let e=new Date,t=(new Date(e.getFullYear()+1,0,0).getTime()-new Date(e.getFullYear(),0,0).getTime())/(1e3*60*60*24),r=(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0).getTime()-new Date(e.getFullYear(),0,0).getTime())/(1e3*60*60*24);return{spentDayThisYear:r,leftDayThisYear:parseInt(t-r+".0001"),allDayThisYear:t}},be=e=>{let t=[],r=["\u{1F55A}","\u{1F559}","\u{1F558}","\u{1F557}","\u{1F556}","\u{1F555}","\u{1F554}","\u{1F553}","\u{1F552}","\u{1F551}","\u{1F550}","\u{1F55B}"],n=[...r,...r],a=me(),s=ge();t.push({section:"You have",icon:qe(a+""),title:`Spent ${a} meaningful days`,titleCanvas:{canvas:l(a,s,10).canvas,text:l(a,s,10).text},subTitle:"",number:a,accessUnit:void 0});let i=pe(),h=80-i;t.push({section:"You have",icon:"\u{1F38A}",title:`Celebrated ${i} New Year's Days`,titleCanvas:{canvas:l(i,h,10).canvas,text:l(i,h,10).text},subTitle:"",number:pe(),accessUnit:void 0});let f=Be(),v=3-f;t.push({section:"You have",icon:f==1?"\u2708\uFE0F":"\u{1F680}",title:`Witnessed ${f} great centuries`,titleCanvas:{canvas:l(f,v,10).canvas,text:l(f,v,10).text},subTitle:"",number:f,accessUnit:void 0});let{spentPaychecks:g,leftPaychecks:S}=Ye();t.push({section:"You may be able to",icon:"\u{1F4B0}",title:`Receive ${g} generous paychecks`,titleCanvas:{canvas:l(g,S,10).canvas,text:l(g,S,10).text},subTitle:"",number:g,accessUnit:void 0});let{spentWeeks:w,leftWeeks:A}=Ge();t.push({section:"You may be able to",icon:"\u{1F3A1}",title:`Spend ${w} pleasant weekends`,titleCanvas:{canvas:l(w,A,10).canvas,text:l(w,A,10).text},subTitle:"",number:w,accessUnit:void 0}),t.push({section:"You may be able to",icon:"\u{1F319}",title:`Enjoy ${s} wonderful nights`,titleCanvas:{canvas:l(a,s,10).canvas,text:l(a,s,10).text},subTitle:"",number:s,accessUnit:void 0});let $=He();t.push({section:"Countdown Date",icon:n[$],title:`${$} hours left in the day`,titleCanvas:{canvas:l(24-$,$,24).canvas,text:l(24-$,$,24).text},subTitle:"",number:$,accessUnit:void 0});let d=Ke();t.push({section:"Countdown Date",icon:d<=1?"\u{1F3DD}":"\u{1F4BC}",title:`${d} days left in the week`,titleCanvas:{canvas:l(7-d,d,7).canvas,text:l(7-d,d,7).text},subTitle:"",number:d,accessUnit:void 0});let{spentMonth:M,leftMonth:E,allMonth:F}=Je();t.push({section:"Countdown Date",icon:Xe(E),title:`${E} days left in the month`,titleCanvas:{canvas:l(M,E,F).canvas,text:l(M,E,F).text},subTitle:"",number:E,accessUnit:void 0});let{spentDayThisYear:k,leftDayThisYear:m,allDayThisYear:P}=Ze();t.push({section:"Countdown Date",icon:Qe(m),title:`${m} days left in the year`,titleCanvas:{canvas:l(k,m,P).canvas,text:l(k,m,P).text},subTitle:"",number:m,accessUnit:void 0});let V=new Date;return e.forEach(x=>{let z,L;V.getTime()<x.date?(L=Math.floor((x.date-V.getTime())/(1e3*60*60*24)),z=`${L} days left until ${x.title}`):(L=Math.floor((V.getTime()-x.date)/(1e3*60*60*24)),z=`${L} days passed since ${x.title}`),t.push({section:"Countdown Date",icon:x.icon,title:z,titleCanvas:{canvas:new Date(x.date).toLocaleDateString(),text:""},subTitle:x.description,number:m,accessUnit:void 0})}),{lifeProgresses:t}},qe=e=>e.endsWith("0")?"\u{1F308}":e.endsWith("1")?"\u{1F324}":e.endsWith("2")?"\u26C5\uFE0F":e.endsWith("3")?"\u{1F326}":e.endsWith("4")?"\u{1F327}":e.endsWith("5")?"\u26C8\uFE0F":e.endsWith("6")?"\u{1F328}":e.endsWith("7")?"\u{1F325}":e.endsWith("8")?"\u2600\uFE0F":(e.endsWith("9"),"\u{1F308}"),Xe=e=>e<=3?"\u{1F311}":e<=7?"\u{1F318}":e<=11?"\u{1F317}":e<=14?"\u{1F316}":e<=18?"\u{1F315}":e<=21?"\u{1F314}":e<=24?"\u{1F313}":e<=28?"\u{1F312}":"\u{1F311}",Qe=e=>e<=3?"\u{1F38A}":e<=10?"\u{1F381}":e<=40?"\u{1F3EE}":e<=80?"\u2744\uFE0F":e<=120?"\u{1FA86}":e<=150?"\u{1F341}":e<=180?"\u{1F390}":e<=220?"\u26F1":e<=260?"\u{1F338}":e<=300?"\u{1F3EE}":e<=330?"\u{1F9E8}":e<=355?"\u{1F389}":"\u{1F38A}";async function et(){try{let e=await ye.LocalStorage.getItem("Countdown date"),t=typeof e<"u"?JSON.parse(e):[],{lifeProgresses:r}=be(t);return r}catch(e){return console.error("Failed to fetch life progress:",e),[]}}function $e(){return le(()=>et(),[])}var _=require("react/jsx-runtime");function we(){let{data:e,isLoading:t}=$e(),r=(0,J.useMemo)(()=>e||[],[e]),n=(0,J.useMemo)(()=>fe(r),[r]),a=(0,J.useMemo)(()=>{let s="Life Progress",i=p.Icon.Clock;return n&&(s=n?.menuBarInfo.progress+" "+n?.menuBarInfo.title),n&&(i=n?.menuBarInfo.icon),{title:s,icon:i}},[n]);return(0,p.updateCommandMetadata)({subtitle:a.title}).then(),(0,_.jsxs)(p.MenuBarExtra,{isLoading:t,icon:a.icon,title:a.title,tooltip:a.title,children:[(0,_.jsx)(p.MenuBarExtra.Section,{children:n?.progressList.map(s=>(0,_.jsx)(p.MenuBarExtra.Item,{icon:s.icon,title:s.title,subtitle:s.progress,onAction:()=>{}},s.title))}),(0,_.jsx)(p.MenuBarExtra.Section,{children:(0,_.jsx)(p.MenuBarExtra.Item,{icon:p.Icon.Clock,title:he()+" "+de(),onAction:()=>{}})}),(0,_.jsx)(p.MenuBarExtra.Section,{children:(0,_.jsx)(p.MenuBarExtra.Item,{title:"Settings...",icon:p.Icon.Gear,onAction:async()=>{await(0,p.openCommandPreferences)()}})})]})}
