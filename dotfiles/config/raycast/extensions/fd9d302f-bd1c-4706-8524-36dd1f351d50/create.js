"use strict";var K=Object.create;var A=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var r in t)A(e,r,{get:t[r],enumerable:!0})},I=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Z(t))!Y.call(e,a)&&a!==r&&A(e,a,{get:()=>t[a],enumerable:!(n=J(t,a))||n.enumerable});return e};var O=(e,t,r)=>(r=e!=null?K(q(e)):{},I(t||!e||!e.__esModule?A(r,"default",{value:e,enumerable:!0}):r,e)),Q=e=>I(A({},"__esModule",{value:!0}),e);var ae={};X(ae,{default:()=>j});module.exports=Q(ae);var i=require("@raycast/api");var P=require("node:crypto");var L="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var ee=128,g,k;function te(e){!g||g.length<e?(g=Buffer.allocUnsafe(e*ee),P.webcrypto.getRandomValues(g),k=0):k+e>g.length&&(P.webcrypto.getRandomValues(g),k=0),k+=e}function M(e=21){te(e|=0);let t="";for(let r=k-e;r<k;r++)t+=L[g[r]&63];return t}var S=require("@raycast/api"),x=O(require("fs")),T=(0,S.getPreferenceValues)(),v=T.sshConfig==="localStorage"?"localStorage":T.sshConfigFile||T.sshConfig.replace("~",process.env.HOME||"");function re(e){let r=x.readFileSync(e,"utf8").split(`
`),n=[],a=null;for(let $ of r){let u=$.trim();if(!(u.startsWith("#")||u==="")){if(u.startsWith("Host ")&&u!=="Host *")a!==null&&n.push(a),a={id:n.length.toString(),address:"",name:u.substring(5),user:""};else if(a!==null){let p=u.indexOf(" "),m=u.substring(0,p),h=u.substring(p+1);switch(m){case"HostName":a.address=h;break;case"User":a.user=h;break;case"Port":a.port=h;break;case"IdentityFile":a.sshKey=h;break;case"HostNameKey":break;case"RemoteCommand":a.command=h;break;default:break}}}}return a!==null&&n.push(a),n}function ne(e,t){let r="";for(let n of t)r+=`Host ${n.name}
`,r+=`  HostName ${n.address}
`,n.user&&(r+=`  User ${n.user}
`),n.port&&(r+=`  Port ${n.port}
`),n.sshKey&&(r+=`  IdentityFile ${n.sshKey}
`),n.command&&(r+=`  RemoteCommand ${n.command}
`),r+=`
`;x.writeFileSync(e,r.trimEnd())}async function D(){switch(v){case"localStorage":{let{connections:e}=await S.LocalStorage.allItems();return e?JSON.parse(e):[]}default:return x.existsSync(v)?re(v):[]}}async function W(e){switch(v){case"localStorage":await S.LocalStorage.setItem("connections",JSON.stringify(e));break;default:ne(v,e);break}}var o=O(require("react")),c=require("@raycast/api");var N=require("react/jsx-runtime");function V(e){let t=(0,o.useRef)(e);return t.current=e,t}var z=(function(e){return e.Required="required",e})({});function _(e,t){if(e){if(typeof e=="function")return e(t);if(e==="required"){let r=typeof t<"u"&&t!==null;if(r)switch(typeof t){case"string":r=t.length>0;break;case"object":Array.isArray(t)?r=t.length>0:t instanceof Date&&(r=t.getTime()>0);break;default:break}if(!r)return"The item is required"}}}function F(e){let{onSubmit:t,validation:r,initialValues:n={}}=e,[a,$]=(0,o.useState)(n),[u,p]=(0,o.useState)({}),m=(0,o.useRef)({}),h=V(r||{}),U=V(t),R=(0,o.useCallback)(l=>{m.current[l]?.focus()},[m]),B=(0,o.useCallback)(async l=>{let s=!1;for(let[y,b]of Object.entries(h.current)){let w=_(b,l[y]);w&&(s||(s={},R(y)),s[y]=w)}if(s)return p(s),!1;let f=await U.current(l);return typeof f=="boolean"?f:!0},[h,U,R]),E=(0,o.useCallback)((l,s)=>{p(f=>({...f,[l]:s}))},[p]),C=(0,o.useCallback)(function(l,s){$(f=>({...f,[l]:typeof s=="function"?s(f[l]):s}))},[$]),H=(0,o.useMemo)(()=>new Proxy({},{get(l,s){let f=h.current[s],y=a[s];return{onChange(b){u[s]&&(_(f,b)||E(s,void 0)),C(s,b)},onBlur(b){let w=_(f,b.target.value);w&&E(s,w)},error:u[s],id:s,value:typeof y>"u"?null:y,ref:b=>{m.current[s]=b}}}}),[u,h,E,a,m,C]),G=(0,o.useCallback)(l=>{p({}),Object.entries(m.current).forEach(([s,f])=>{l?.[s]||f?.reset()}),l&&$(l)},[$,p,m]);return{handleSubmit:B,setValidationError:E,setValue:C,values:a,itemProps:H,focus:R,reset:G}}var d=require("react/jsx-runtime");function j(){let{handleSubmit:e,itemProps:t}=F({onSubmit(n){r(n)},validation:{name:z.Required}});async function r(n){let a=await D();a.push({...n,id:M()}),await W(a),await(0,i.showHUD)(`\u2705 Connection [${n.name}] saved!`,{popToRootType:i.PopToRootType.Immediate})}return(0,d.jsxs)(i.Form,{actions:(0,d.jsx)(i.ActionPanel,{children:(0,d.jsx)(i.Action.SubmitForm,{icon:i.Icon.SaveDocument,title:"Save",onSubmit:e})}),children:[(0,d.jsx)(i.Form.TextField,{title:"Connection Name",...t.name}),(0,d.jsx)(i.Form.TextField,{title:"Server Address",placeholder:"A resolvable DNS name or IP",...t.address}),(0,d.jsx)(i.Form.TextField,{title:"Username (optional)",placeholder:"A username to authenticate with",...t.user}),(0,d.jsx)(i.Form.TextField,{title:"Port (optional)",placeholder:"An optional custom port (other than 22)",...t.port}),(0,d.jsx)(i.Form.TextField,{title:"SSH Key Location (optional)",placeholder:"An optional key path to authenticate with",...t.sshKey}),(0,d.jsx)(i.Form.TextField,{title:"Command to Execute (optional)",placeholder:"An optional command to execute on the remote server after connecting",...t.command})]})}
