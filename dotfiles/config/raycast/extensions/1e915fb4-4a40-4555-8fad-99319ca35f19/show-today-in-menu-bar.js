"use strict";var it=Object.create;var G=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var lt=Object.getPrototypeOf,ut=Object.prototype.hasOwnProperty;var me=(e,r)=>{for(var t in r)G(e,t,{get:r[t],enumerable:!0})},ge=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of ct(r))!ut.call(e,a)&&a!==t&&G(e,a,{get:()=>r[a],enumerable:!(n=ot(r,a))||n.enumerable});return e};var M=(e,r,t)=>(t=e!=null?it(lt(e)):{},ge(r||!e||!e.__esModule?G(t,"default",{value:e,enumerable:!0}):t,e)),ft=e=>ge(G({},"__esModule",{value:!0}),e);var Kt={};me(Kt,{default:()=>et});module.exports=ft(Kt);var c=require("@raycast/api");var p=M(require("react")),$=require("@raycast/api");var be=Object.prototype.hasOwnProperty;function K(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&K(e[n],r[n]););return n===-1}if(!t||typeof e=="object"){n=0;for(t in e)if(be.call(e,t)&&++n&&!be.call(r,t)||!(t in r)||!K(e[t],r[t]))return!1;return Object.keys(r).length===n}}return e!==e&&r!==r}var O=M(require("node:fs")),H=M(require("node:path")),Ae=M(require("node:crypto")),ve=M(require("node:child_process")),Te=require("node:buffer"),z=M(require("node:stream")),Pe=require("node:util");var Ie=require("react/jsx-runtime");var q=globalThis;function dt(e){let r=(0,p.useRef)(e),t=(0,p.useRef)(0);return K(e,r.current)||(r.current=e,t.current+=1),(0,p.useMemo)(()=>r.current,[t.current])}function P(e){let r=(0,p.useRef)(e);return r.current=e,r}function ht(e,r){let t=e instanceof Error?e.message:String(e);return(0,$.showToast)({style:$.Toast.Style.Failure,title:r?.title??"Something went wrong",message:r?.message??t,primaryAction:r?.primaryAction??ye(e),secondaryAction:r?.primaryAction?ye(e):void 0})}var ye=e=>{let r=!0,t="[Extension Name]...",n="";try{let s=JSON.parse((0,O.readFileSync)((0,H.join)($.environment.assetsPath,"..","package.json"),"utf8"));t=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(r=!1)}catch{}let a=$.environment.isDevelopment||r,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?$.Clipboard.copy(i):(0,$.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};function pt(e,r,t){let n=(0,p.useRef)(0),[a,i]=(0,p.useState)({isLoading:!0}),s=P(e),o=P(t?.abortable),l=P(r||[]),f=P(t?.onError),h=P(t?.onData),y=P(t?.onWillExecute),S=P(t?.failureToastOptions),u=P(a.data),w=(0,p.useRef)(null),g=(0,p.useRef)({page:0}),A=(0,p.useRef)(!1),C=(0,p.useRef)(!0),V=(0,p.useRef)(50),v=(0,p.useCallback)(()=>(o.current&&(o.current.current?.abort(),o.current.current=new AbortController),++n.current),[o]),k=(0,p.useCallback)((...U)=>{let T=v();y.current?.(U),i(b=>({...b,isLoading:!0}));let L=mt(s.current)(...U);function F(b){return b.name=="AbortError"||T===n.current&&(f.current?f.current(b):$.environment.launchType!==$.LaunchType.Background&&ht(b,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(_){_.hide(),w.current?.(...l.current||[])}},...S.current}),i({error:b,isLoading:!1})),b}return typeof L=="function"?(A.current=!0,L(g.current).then(({data:b,hasMore:_,cursor:at})=>(T===n.current&&(g.current&&(g.current.cursor=at,g.current.lastItem=b?.[b.length-1]),h.current&&h.current(b,g.current),_&&(V.current=b.length),C.current=_,i(st=>g.current.page===0?{data:b,isLoading:!1}:{data:(st.data||[])?.concat(b),isLoading:!1})),b),b=>(C.current=!1,F(b)))):(A.current=!1,L.then(b=>(T===n.current&&(h.current&&h.current(b),i({data:b,isLoading:!1})),b),F))},[h,f,l,s,i,w,y,g,S,v]);w.current=k;let R=(0,p.useCallback)(()=>{g.current={page:0};let U=l.current||[];return k(...U)},[k,l]),D=(0,p.useCallback)(async(U,T)=>{let L;try{if(T?.optimisticUpdate){v(),typeof T?.rollbackOnError!="function"&&T?.rollbackOnError!==!1&&(L=structuredClone(u.current?.value));let F=T.optimisticUpdate;i(b=>({...b,data:F(b.data)}))}return await U}catch(F){if(typeof T?.rollbackOnError=="function"){let b=T.rollbackOnError;i(_=>({..._,data:b(_.data)}))}else T?.optimisticUpdate&&T?.rollbackOnError!==!1&&i(b=>({...b,data:L}));throw F}finally{T?.shouldRevalidateAfter!==!1&&($.environment.launchType===$.LaunchType.Background||$.environment.commandMode==="menu-bar"?await R():R())}},[R,u,i,v]),B=(0,p.useCallback)(()=>{g.current.page+=1;let U=l.current||[];k(...U)},[g,l,k]);(0,p.useEffect)(()=>{g.current={page:0},t?.execute!==!1?k(...r||[]):v()},[dt([r,t?.execute,k]),o,g]),(0,p.useEffect)(()=>()=>{v()},[v]);let tt=t?.execute!==!1?a.isLoading:!1,rt={...a,isLoading:tt},nt=A.current?{pageSize:V.current,hasMore:C.current,onLoadMore:B}:void 0;return{...rt,revalidate:R,mutate:D,pagination:nt}}function mt(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function $e(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function gt(e){return e instanceof URLSearchParams?e.toString():e}function Ce(e,r=[]){function t(n){return"update"in e?e.update(n,"utf8"):e.write(n)}return{dispatch:function(n){n=gt(n),n===null?this._null():this["_"+typeof n](n)},_object:function(n){let a=/\[object (.*)\]/i,i=Object.prototype.toString.call(n),s=a.exec(i)?.[1]??"unknown:["+i+"]";s=s.toLowerCase();let o=null;if((o=r.indexOf(n))>=0){this.dispatch("[CIRCULAR:"+o+"]");return}else r.push(n);if(Buffer.isBuffer(n))return t("buffer:"),t(n.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](n);else throw new Error('Unknown object type "'+s+'"');else{let l=Object.keys(n);l=l.sort(),$e(n)||l.splice(0,0,"prototype","__proto__","constructor"),t("object:"+l.length+":");let f=this;return l.forEach(function(h){f.dispatch(h),t(":"),f.dispatch(n[h]),t(",")})}},_array:function(n,a){a=typeof a<"u"?a:!1;let i=this;if(t("array:"+n.length+":"),!a||n.length<=1){n.forEach(function(l){i.dispatch(l)});return}let s=[],o=n.map(function(l){let f=bt(),h=r.slice();return Ce(f,h).dispatch(l),s=s.concat(h.slice(r.length)),f.read().toString()});r=r.concat(s),o.sort(),this._array(o,!1)},_date:function(n){t("date:"+n.toJSON())},_symbol:function(n){t("symbol:"+n.toString())},_error:function(n){t("error:"+n.toString())},_boolean:function(n){t("bool:"+n.toString())},_string:function(n){t("string:"+n.length+":"),t(n.toString())},_function:function(n){t("fn:"),$e(n)?this.dispatch("[native]"):this.dispatch(n.toString()),this.dispatch("function-name:"+String(n.name)),this._object(n)},_number:function(n){t("number:"+n.toString())},_xml:function(n){t("xml:"+n.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(n){t("regex:"+n.toString())},_uint8array:function(n){t("uint8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint8clampedarray:function(n){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(n))},_int8array:function(n){t("int8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint16array:function(n){t("uint16array:"),this.dispatch(Array.prototype.slice.call(n))},_int16array:function(n){t("int16array:"),this.dispatch(Array.prototype.slice.call(n))},_uint32array:function(n){t("uint32array:"),this.dispatch(Array.prototype.slice.call(n))},_int32array:function(n){t("int32array:"),this.dispatch(Array.prototype.slice.call(n))},_float32array:function(n){t("float32array:"),this.dispatch(Array.prototype.slice.call(n))},_float64array:function(n){t("float64array:"),this.dispatch(Array.prototype.slice.call(n))},_arraybuffer:function(n){t("arraybuffer:"),this.dispatch(new Uint8Array(n))},_url:function(n){t("url:"+n.toString())},_map:function(n){t("map:");let a=Array.from(n);this._array(a,!0)},_set:function(n){t("set:");let a=Array.from(n);this._array(a,!0)},_file:function(n){t("file:"),this.dispatch([n.name,n.size,n.type,n.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(n){t("bigint:"+n.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function bt(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function yt(e,r){let t=this[e];return t instanceof Date?`__raycast_cached_date__${t.toString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:r}function $t(e,r){return typeof r=="string"&&r.startsWith("__raycast_cached_date__")?new Date(r.replace("__raycast_cached_date__","")):typeof r=="string"&&r.startsWith("__raycast_cached_buffer__")?Buffer.from(r.replace("__raycast_cached_buffer__",""),"base64"):r}function we(e){let r=Ae.default.createHash("sha1");return Ce(r).dispatch(e),r.digest("hex")}var wt=Symbol("cache without namespace"),ke=new Map;function kt(e,r,t){let n=t?.cacheNamespace||wt,a=ke.get(n)||ke.set(n,new $.Cache({namespace:t?.cacheNamespace})).get(n);if(!a)throw new Error("Missing cache");let i=P(e),s=P(r),o=(0,p.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(i.current)}catch(y){console.error("Could not get Cache data:",y);return}}),l=(0,p.useMemo)(()=>{if(typeof o<"u"){if(o==="undefined")return;try{return JSON.parse(o,$t)}catch(y){return console.warn("The cached data is corrupted",y),s.current}}else return s.current},[o,s]),f=P(l),h=(0,p.useCallback)(y=>{let S=typeof y=="function"?y(f.current):y;if(typeof S>"u")a.set(i.current,"undefined");else{let u=JSON.stringify(S,yt);a.set(i.current,u)}return S},[a,i,f]);return[l,h]}var W=Symbol();function ne(e,r,t){let{initialData:n,keepPreviousData:a,internal_cacheKeySuffix:i,...s}=t||{},o=(0,p.useRef)(null),[l,f]=kt(we(r||[])+i,W,{cacheNamespace:we(e)}),h=(0,p.useRef)(l!==W?l:n),y=(0,p.useRef)(void 0),{mutate:S,revalidate:u,...w}=pt(e,r||[],{...s,onData(v,k){y.current=k,s.onData&&s.onData(v,k),!(k&&k.page>0)&&(o.current="promise",h.current=v,f(v))}}),g,A=w.pagination;y.current&&y.current.page>0&&w.data?g=w.data:o.current==="promise"?g=h.current:a&&l!==W?(g=l,A&&(A.hasMore=!0,A.pageSize=l.length)):a&&l===W?g=h.current:l!==W?(g=l,A&&(A.hasMore=!0,A.pageSize=l.length)):g=n;let C=P(g),V=(0,p.useCallback)(async(v,k)=>{let R;try{if(k?.optimisticUpdate){typeof k?.rollbackOnError!="function"&&k?.rollbackOnError!==!1&&(R=structuredClone(C.current));let D=k.optimisticUpdate(C.current);o.current="cache",h.current=D,f(D)}return await S(v,{shouldRevalidateAfter:k?.shouldRevalidateAfter})}catch(D){if(typeof k?.rollbackOnError=="function"){let B=k.rollbackOnError(C.current);o.current="cache",h.current=B,f(B)}else k?.optimisticUpdate&&k?.rollbackOnError!==!1&&(o.current="cache",h.current=R,f(R));throw D}},[f,S,C,h,o]);return(0,p.useEffect)(()=>{l!==W&&(o.current="cache",h.current=l)},[l]),{data:g,isLoading:w.isLoading,error:w.error,mutate:y.current&&y.current.page>0?S:V,pagination:A,revalidate:u}}var J=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",Y=Symbol.for("signal-exit emitter"),Q=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),q[Y])return q[Y];Object.defineProperty(q,Y,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(r,t){this.listeners[r].push(t)}removeListener(r,t){let n=this.listeners[r],a=n.indexOf(t);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(r,t,n){if(this.emitted[r])return!1;this.emitted[r]=!0;let a=!1;for(let i of this.listeners[r])a=i(t,n)===!0||a;return r==="exit"&&(a=this.emit("afterExit",t,n)||a),a}},ee=class{onExit(){return()=>{}}load(){}unload(){}},te=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(r){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new Q,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=r,this.#a={};for(let t of this.#r)this.#a[t]=()=>{let n=this.#e.listeners(t),{count:a}=this.#t,i=r;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),n.length===a){this.unload();let s=this.#t.emit("exit",null,t),o=t==="SIGHUP"?this.#o:t;s||r.kill(r.pid,o)}};this.#i=r.reallyExit,this.#s=r.emit}onExit(r,t){if(!J(this.#e))return()=>{};this.#n===!1&&this.load();let n=t?.alwaysLast?"afterExit":"exit";return this.#t.on(n,r),()=>{this.#t.removeListener(n,r),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let r of this.#r)try{let t=this.#a[r];t&&this.#e.on(r,t)}catch{}this.#e.emit=(r,...t)=>this.#l(r,...t),this.#e.reallyExit=r=>this.#c(r)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(r=>{let t=this.#a[r];if(!t)throw new Error("Listener not defined for signal: "+r);try{this.#e.removeListener(r,t)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(r){return J(this.#e)?(this.#e.exitCode=r||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(r,...t){let n=this.#s;if(r==="exit"&&J(this.#e)){typeof t[0]=="number"&&(this.#e.exitCode=t[0]);let a=n.call(this.#e,r,...t);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,r,...t)}},X=null,xt=(e,r)=>(X||(X=J(process)?new te(process):new ee),X.onExit(e,r));function St(e,{timeout:r}={}){let t=new Promise((o,l)=>{e.on("exit",(f,h)=>{o({exitCode:f,signal:h,timedOut:!1})}),e.on("error",f=>{l(f)}),e.stdin&&e.stdin.on("error",f=>{l(f)})}),n=xt(()=>{e.kill()});if(r===0||r===void 0)return t.finally(()=>n());let a,i=new Promise((o,l)=>{a=setTimeout(()=>{e.kill("SIGTERM"),l(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},r)}),s=t.finally(()=>{clearTimeout(a)});return Promise.race([i,s]).finally(()=>n())}var re=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Et(e){let{encoding:r}=e,t=r==="buffer",n=new z.default.PassThrough({objectMode:!1});r&&r!=="buffer"&&n.setEncoding(r);let a=0,i=[];return n.on("data",s=>{i.push(s),a+=s.length}),n.getBufferedValue=()=>t?Buffer.concat(i,a):i.join(""),n.getBufferedLength=()=>a,n}async function xe(e,r){let t=Et(r);return await new Promise((n,a)=>{let i=s=>{s&&t.getBufferedLength()<=Te.constants.MAX_LENGTH&&(s.bufferedData=t.getBufferedValue()),a(s)};(async()=>{try{await(0,Pe.promisify)(z.default.pipeline)(e,t),n()}catch(s){i(s)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&i(new re)})}),t.getBufferedValue()}async function Se(e,r){e.destroy();try{return await r}catch(t){return t.bufferedData}}async function At({stdout:e,stderr:r},{encoding:t},n){let a=xe(e,{encoding:t}),i=xe(r,{encoding:t});try{return await Promise.all([n,a,i])}catch(s){return Promise.all([{error:s,exitCode:null,signal:s.signal,timedOut:s.timedOut||!1},Se(e,a),Se(r,i)])}}function vt(e){let r=typeof e=="string"?`
`:10,t=typeof e=="string"?"\r":13;return e[e.length-1]===r&&(e=e.slice(0,-1)),e[e.length-1]===t&&(e=e.slice(0,-1)),e}function Ee(e,r){return e.stripFinalNewline?vt(r):r}function Tt({timedOut:e,timeout:r,signal:t,exitCode:n}){return e?`timed out after ${r} milliseconds`:t!=null?`was killed with ${t}`:n!=null?`failed with exit code ${n}`:"failed"}function Pt({stdout:e,stderr:r,error:t,signal:n,exitCode:a,command:i,timedOut:s,options:o,parentError:l}){let h=`Command ${Tt({timedOut:s,timeout:o?.timeout,signal:n,exitCode:a})}: ${i}`,y=t?`${h}
${t.message}`:h,S=[y,r,e].filter(Boolean).join(`
`);return t?t.originalMessage=t.message:t=l,t.message=S,t.shortMessage=y,t.command=i,t.exitCode=a,t.signal=n,t.stdout=e,t.stderr=r,"bufferedData"in t&&delete t.bufferedData,t}function It({stdout:e,stderr:r,error:t,exitCode:n,signal:a,timedOut:i,command:s,options:o,parentError:l}){if(t||n!==0||a!==null)throw Pt({error:t,exitCode:n,signal:a,stdout:e,stderr:r,command:s,timedOut:i,options:o,parentError:l});return e}async function Re(e,r,t){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:i,...s}=Array.isArray(r)?t||{}:r||{},o=n!==!1?[]:["-ss"];a==="JavaScript"&&o.push("-l","JavaScript"),Array.isArray(r)&&o.push("-",...r);let l=ve.default.spawn("osascript",o,{...s,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),f=St(l,{timeout:i??1e4});l.stdin.end(e);let[{error:h,exitCode:y,signal:S,timedOut:u},w,g]=await At(l,{encoding:"utf8"},f),A=Ee({stripFinalNewline:!0},w),C=Ee({stripFinalNewline:!0},g);return It({stdout:A,stderr:C,error:h,exitCode:y,signal:S,timedOut:u,command:"osascript",options:t,parentError:new Error})}var Ge=require("child_process"),Ke=require("util"),I=require("@raycast/api");var le={};me(le,{exclude:()=>Dt,extract:()=>oe,parse:()=>ce,parseUrl:()=>We,pick:()=>Ve,stringify:()=>Me,stringifyUrl:()=>ze});var Oe="%[a-f0-9]{2}",Ue=new RegExp("("+Oe+")|([^%]+?)","gi"),_e=new RegExp("("+Oe+")+","gi");function ae(e,r){try{return[decodeURIComponent(e.join(""))]}catch{}if(e.length===1)return e;r=r||1;let t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],ae(t),ae(n))}function Ct(e){try{return decodeURIComponent(e)}catch{let r=e.match(Ue)||[];for(let t=1;t<r.length;t++)e=ae(r,t).join(""),r=e.match(Ue)||[];return e}}function Rt(e){let r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=_e.exec(e);for(;t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{let a=Ct(t[0]);a!==t[0]&&(r[t[0]]=a)}t=_e.exec(e)}r["%C2"]="\uFFFD";let n=Object.keys(r);for(let a of n)e=e.replace(new RegExp(a,"g"),r[a]);return e}function se(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return Rt(e)}}function je(e,r){let t={};if(Array.isArray(r))for(let n of r){let a=Object.getOwnPropertyDescriptor(e,n);a?.enumerable&&Object.defineProperty(t,n,a)}else for(let n of Reflect.ownKeys(e)){let a=Object.getOwnPropertyDescriptor(e,n);if(a.enumerable){let i=e[n];r(n,i,e)&&Object.defineProperty(t,n,a)}}return t}function Z(e,r){if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e===""||r==="")return[];let t=e.indexOf(r);return t===-1?[]:[e.slice(0,t),e.slice(t+r.length)]}var Ut=e=>e==null,_t=e=>encodeURIComponent(e).replaceAll(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`),ie=Symbol("encodeFragmentIdentifier");function Ot(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[x(r,e),"[",a,"]"].join("")]:[...t,[x(r,e),"[",x(a,e),"]=",x(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[x(r,e),"[]"].join("")]:[...t,[x(r,e),"[]=",x(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[x(r,e),":list="].join("")]:[...t,[x(r,e),":list=",x(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[x(t,e),r,x(a,e)].join("")]:[[n,x(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,x(r,e)]:[...t,[x(r,e),"=",x(n,e)].join("")]}}function jt(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[...a[t],n]};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[...a[t],n]};case"comma":case"separator":return(t,n,a)=>{let s=typeof n=="string"&&n.includes(e.arrayFormatSeparator)?n.split(e.arrayFormatSeparator).map(o=>j(o,e)):n===null?n:j(n,e);a[t]=s};case"bracket-separator":return(t,n,a)=>{let i=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!i){a[t]=n&&j(n,e);return}let s=n===null?[]:j(n,e).split(e.arrayFormatSeparator);if(a[t]===void 0){a[t]=s;return}a[t]=[...a[t],...s]};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[...[a[t]].flat(),n]}}}function De(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function x(e,r){return r.encode?r.strict?_t(e):encodeURIComponent(e):e}function j(e,r){return r.decode?se(e):e}function Le(e){return Array.isArray(e)?e.sort():typeof e=="object"?Le(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function Fe(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function Nt(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Ne(e,r,t){return t==="string"&&typeof e=="string"?e:typeof t=="function"&&typeof e=="string"?t(e):t==="boolean"&&e===null?!0:t==="boolean"&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")?e.toLowerCase()==="true":t==="boolean"&&e!==null&&(e.toLowerCase()==="1"||e.toLowerCase()==="0")?e.toLowerCase()==="1":t==="string[]"&&r.arrayFormat!=="none"&&typeof e=="string"?[e]:t==="number[]"&&r.arrayFormat!=="none"&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?[Number(e)]:t==="number"&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")?e.toLowerCase()==="true":r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?Number(e):e}function oe(e){e=Fe(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function ce(e,r){r={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...r},De(r.arrayFormatSeparator);let t=jt(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let i=r.decode?a.replaceAll("+"," "):a,[s,o]=Z(i,"=");s===void 0&&(s=i),o=o===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?o:j(o,r),t(j(s,r),o,n)}for(let[a,i]of Object.entries(n))if(typeof i=="object"&&i!==null&&r.types[a]!=="string")for(let[s,o]of Object.entries(i)){let l=r.types[a],f=typeof l=="function"?l:l?l.replace("[]",""):void 0;i[s]=Ne(o,r,f)}else typeof i=="object"&&i!==null&&r.types[a]==="string"?n[a]=Object.values(i).join(r.arrayFormatSeparator):n[a]=Ne(i,r,r.types[a]);return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,i)=>{let s=n[i];return a[i]=s&&typeof s=="object"&&!Array.isArray(s)?Le(s):s,a},Object.create(null))}function Me(e,r){if(!e)return"";r={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...r},De(r.arrayFormatSeparator);let t=s=>r.skipNull&&Ut(e[s])||r.skipEmptyString&&e[s]==="",n=Ot(r),a={};for(let[s,o]of Object.entries(e))t(s)||(a[s]=o);let i=Object.keys(a);return r.sort!==!1&&i.sort(r.sort),i.map(s=>{let o=e[s];if(r.replacer&&(o=r.replacer(s,o),o===void 0)||o===void 0)return"";if(o===null)return x(s,r);if(Array.isArray(o)){if(o.length===0&&r.arrayFormat==="bracket-separator")return x(s,r)+"[]";let l=o;return r.replacer&&(l=o.map((f,h)=>r.replacer(`${s}[${h}]`,f)).filter(f=>f!==void 0)),l.reduce(n(s),[]).join("&")}return x(s,r)+"="+x(o,r)}).filter(s=>s.length>0).join("&")}function We(e,r){r={decode:!0,...r};let[t,n]=Z(e,"#");return t===void 0&&(t=e),{url:t?.split("?")?.[0]??"",query:ce(oe(e),r),...r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:j(n,r)}:{}}}function ze(e,r){r={encode:!0,strict:!0,[ie]:!0,...r};let t=Fe(e.url).split("?")[0]||"",n=oe(e.url),a={...ce(n,{sort:!1,...r}),...e.query},i=Me(a,r);i&&=`?${i}`;let s=Nt(e.url);if(typeof e.fragmentIdentifier=="string"){let o=new URL(t);o.hash=e.fragmentIdentifier,s=r[ie]?o.hash:`#${e.fragmentIdentifier}`}return`${t}${i}${s}`}function Ve(e,r,t){t={parseFragmentIdentifier:!0,[ie]:!1,...t};let{url:n,query:a,fragmentIdentifier:i}=We(e,t);return ze({url:n,query:je(a,r),fragmentIdentifier:i},t)}function Dt(e,r,t){let n=Array.isArray(r)?a=>!r.includes(a):(a,i)=>!r(a,i);return Ve(e,n,t)}var Be=le;var ue=(0,I.getPreferenceValues)(),N=class extends Error{constructor(t,n,a,i){super(i?`${i}: ${t}`:t);this.type=n;this.originalError=a;this.operation=i;this.name="ThingsError"}},fe=async(e,r)=>{try{let t=await Re(`(function(){${e}})()`,{humanReadableOutput:!1,language:"JavaScript",timeout:6e4});return t?JSON.parse(t.replace(/:\s*undefined/g,": null")):void 0}catch(t){let a=(typeof t=="string"?t:t instanceof Error?t.message:String(t)).replace("execution error: Error: ","");throw a.match(/Application can't be found/i)?new N("Things application not found. Please make sure Things is installed and running.","APP_NOT_FOUND",a,r):a.match(/not allowed assistive access/i)||a.match(/permission/i)||a.match(/-1743/)?new N("Permission denied. Please grant Raycast access to Things in System Settings > Privacy & Security > Automation > Raycast > Things.","PERMISSION_DENIED",a,r):a.match(/doesn't understand/i)||a.match(/can't get/i)?new N("Things automation interface error. This might be due to a Things version incompatibility or the app not being ready.","EXECUTION_ERROR",a,r):a.match(/timed out/i)?new N("Command timed out. Things may be unresponsive or not running.","EXECUTION_ERROR",a,r):new N(`Unexpected error: ${a}`,"UNKNOWN_ERROR",a,r)}},Lt={inbox:"TMInboxListSource",today:"TMTodayListSource",anytime:"TMNextListSource",upcoming:"TMCalendarListSource",someday:"TMSomedayListSource",logbook:"TMLogbookListSource",trash:"TMTrashListSource"},Je=e=>fe(`
  const things = Application('${ue.thingsAppIdentifier}');
  const todos = things.lists.byId('${Lt[e]}').toDos();

  return todos.map(todo => {
    const props = todo.properties();

    let project = null;
    const projectRef = props.project;
    if (projectRef) {
      const projectProps = projectRef.properties();
      let projectArea = null;
      const projectAreaRef = projectProps.area;
      if (projectAreaRef) {
        const areaProps = projectAreaRef.properties();
        projectArea = { id: areaProps.id, name: areaProps.name };
      }
      project = {
        id: projectProps.id,
        name: projectProps.name,
        status: projectProps.status,
        tags: projectRef.tagNames(),
        dueDate: projectProps.dueDate ? projectProps.dueDate.toISOString() : null,
        activationDate: projectProps.activationDate ? projectProps.activationDate.toISOString() : null,
        area: projectArea,
      };
    }

    let area = null;
    const areaRef = props.area;
    if (areaRef && !projectRef) {
      const areaProps = areaRef.properties();
      area = { id: areaProps.id, name: areaProps.name };
    }

    return {
      id: props.id,
      name: props.name,
      status: props.status,
      notes: props.notes,
      tags: todo.tagNames(),
      dueDate: props.dueDate ? props.dueDate.toISOString() : null,
      activationDate: props.activationDate ? props.activationDate.toISOString() : null,
      isProject: props.pcls === "project",
      project,
      area,
    };
  });
`,`Get ${e} list`);var He=(e,r,t)=>fe(`
  const things = Application('${ue.thingsAppIdentifier}');
  things.toDos.byId('${e}').${r} = '${t}';
`,"Set todo property");var Ft="tag => tag.name()",Mt=`todo => {
  const props = todo.properties();
  return {
    id: props.id,
    name: props.name,
    status: props.status,
    notes: props.notes,
    tags: todo.tagNames(),
    dueDate: props.dueDate ? props.dueDate.toISOString() : null,
    activationDate: props.activationDate ? props.activationDate.toISOString() : null,
  };
}`,Wt=`project => {
  const props = project.properties();
  const areaRef = props.area;
  let area = null;
  if (areaRef) {
    const areaProps = areaRef.properties();
    area = { id: areaProps.id, name: areaProps.name, tags: areaRef.tagNames() };
  }
  return {
    id: props.id,
    name: props.name,
    status: props.status,
    notes: props.notes,
    tags: project.tagNames(),
    dueDate: props.dueDate ? props.dueDate.toISOString() : null,
    activationDate: props.activationDate ? props.activationDate.toISOString() : null,
    area,
    todos: project.toDos().map(${Mt})
  };
}`,zt=`todo => {
  const props = todo.properties();
  return {
    id: props.id,
    name: props.name,
    status: props.status,
    notes: props.notes,
    tags: todo.tagNames(),
    dueDate: props.dueDate ? props.dueDate.toISOString() : null,
    activationDate: props.activationDate ? props.activationDate.toISOString() : null,
    isProject: props.pcls === "project",
  };
}`,Vt=`area => {
  const props = area.properties();
  return {
    id: props.id,
    name: props.name,
    tags: area.tagNames(),
    todos: area.toDos().map(${zt})
  };
}`,Bt=[{name:"tags",needs:["tags"],expr:`things.tags().map(${Ft})`},{name:"projects",needs:["projects","lists"],expr:`things.projects().map(${Wt})`},{name:"areas",needs:["areas","lists"],expr:`things.areas().map(${Vt})`}];async function Ze(...e){let r=new Set(e),t=[`const things = Application('${ue.thingsAppIdentifier}');`,"const result = {};",...Bt.filter(({needs:a})=>a.some(i=>r.has(i))).map(({name:a,expr:i})=>`result.${a} = ${i};`),"return result;"].join(`
`),n=await fe(t,`Get ${e.join(", ")}`);return Object.fromEntries(e.map(a=>[a,a==="lists"?Gt(n.projects,n.areas):n[a]]))}function Gt(e=[],r=[]){let t=e.filter(a=>!a.area).map(a=>({...a,type:"project"})),n=[];return r.forEach(a=>{n.push({...a,type:"area"});let i=e.filter(s=>s.area&&s.area.id===a.id).map(s=>({...s,type:"project"}));n.push(...i)}),[...t,...n]}async function qe(e){await(0,Ke.promisify)(Ge.exec)(`open -g "${e}"`)}function Ye(e){return Be.stringify(e,{skipNull:!0,skipEmptyString:!0})}async function de(e,r){let{authToken:t}=(0,I.getPreferenceValues)();if(!t)throw new Error("unauthorized");await qe(`things:///update?${Ye({"auth-token":t,id:e,...r})}`)}async function he(e,r){let{authToken:t}=(0,I.getPreferenceValues)();if(!t)throw new Error("unauthorized");await qe(`things:///update-project?${Ye({"auth-token":t,id:e,...r})}`)}function pe(e,r){if(e instanceof Error&&e.message==="unauthorized"){(0,I.showToast)({style:I.Toast.Style.Failure,title:"This action needs an authentication token.",message:`Please set it in the extension preferences.
You can find your unique token in Things\u2019 settings. go to Things \u2192 Settings \u2192 General \u2192 Enable Things URLs \u2192 Manage`,primaryAction:{title:"Open Extension Preferences",onAction(t){(0,I.openExtensionPreferences)(),t.hide()}}});return}(0,I.showToast)({style:I.Toast.Style.Failure,title:r??"Something went wrong",message:e instanceof Error?e.message:String(e)})}var m=require("@raycast/api"),E={inbox:{title:"Inbox",icon:{source:m.Icon.Tray,tintColor:m.Color.Blue}},today:{title:"Today",icon:{source:m.Icon.Star,tintColor:m.Color.Yellow}},evening:{title:"This Evening",icon:{source:m.Icon.Moon,tintColor:m.Color.Purple}},tomorrow:{title:"Tomorrow",icon:{source:m.Icon.ArrowClockwise,tintColor:m.Color.Orange}},upcoming:{title:"Upcoming",icon:{source:m.Icon.Calendar,tintColor:m.Color.Red}},anytime:{title:"Anytime",icon:{source:m.Icon.Layers,tintColor:m.Color.Green}},someday:{title:"Someday",icon:{source:m.Icon.Folder,tintColor:m.Color.SecondaryText}},logbook:{title:"Logbook",icon:{source:m.Icon.CheckCircle,tintColor:m.Color.Green}},list:e=>({title:e.name,icon:e.type==="area"?{source:m.Icon.Folder,tintColor:m.Color.Green}:{source:m.Icon.Circle,tintColor:m.Color.Blue}})},cr={open:m.Icon.Circle,completed:{source:m.Icon.CheckCircle,tintColor:m.Color.Blue},canceled:{source:m.Icon.XMarkCircle,tintColor:m.Color.SecondaryText}},Xe={open:m.Icon.Circle,completed:m.Icon.CheckCircle,canceled:m.Icon.XMarkCircle};var d=require("react/jsx-runtime"),Qe=30;function et(){let{shouldShowShortcuts:e,displayTodo:r}=(0,c.getPreferenceValues)(),{data:t,isLoading:n,mutate:a}=ne(()=>Je("today")),{data:i}=ne(()=>Ze("lists")),s=i?.lists,o=t?.find(u=>u.status==="open"),l=o?.name||"",f="";r&&(f=l.length>Qe?l.substring(0,Qe)+"\u2026":l);async function h(u){await a(He(u.id,"status","completed"),{optimisticUpdate(w){if(w)return w.filter(g=>g.id!==u.id)},shouldRevalidateAfter:!1}),await(0,c.showToast)({style:c.Toast.Style.Success,title:"Marked as Completed"})}async function y(u,w){try{u.isProject?await he(u.id,{when:w}):await de(u.id,{when:w}),await a(),await(0,c.showToast)({style:c.Toast.Style.Success,title:"Scheduled to-do"})}catch(g){pe(g)}}async function S(u,w){try{u.isProject?await he(u.id,{"area-id":w}):await de(u.id,{"list-id":w}),await a(),await(0,c.showToast)({style:c.Toast.Style.Success,title:"Moved to-do"})}catch(g){pe(g)}}return(0,d.jsxs)(c.MenuBarExtra,{icon:"things-flat.png",title:f,tooltip:l,isLoading:n,children:[t&&t.length>0?(0,d.jsxs)(d.Fragment,{children:[r&&o?(0,d.jsx)(c.MenuBarExtra.Item,{title:"Complete",icon:c.Icon.CheckCircle,onAction:()=>h(o)}):null,(0,d.jsxs)(c.MenuBarExtra.Section,{children:[(0,d.jsx)(c.MenuBarExtra.Item,{title:"Today"}),t.map(u=>(0,d.jsxs)(c.MenuBarExtra.Submenu,{title:u.name,icon:Xe[u.status],children:[(0,d.jsx)(c.MenuBarExtra.Item,{title:"Complete",icon:c.Icon.CheckCircle,onAction:()=>h(u)}),(0,d.jsx)(c.MenuBarExtra.Item,{title:"Show in Things",icon:"things-flat.png",onAction:()=>{(0,c.open)(`things:///show?id=${u.id}`)}}),(0,d.jsxs)(c.MenuBarExtra.Submenu,{title:"Schedule",icon:c.Icon.Calendar,children:[(0,d.jsx)(c.MenuBarExtra.Item,{...E.today,onAction:()=>y(u,"today")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.evening,onAction:()=>y(u,"evening")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.tomorrow,onAction:()=>y(u,"tomorrow")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.anytime,onAction:()=>y(u,"anytime")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.someday,onAction:()=>y(u,"someday")})]}),s&&s.length>0?(0,d.jsx)(c.MenuBarExtra.Submenu,{title:"Move To",icon:c.Icon.ArrowRight,children:s.filter(w=>u.isProject?w.type==="area":!0).map(w=>(0,d.jsx)(c.MenuBarExtra.Item,{...E.list(w),onAction:()=>S(u,w.id)},w.id))}):null]},u.id))]})]}):(0,d.jsx)(c.MenuBarExtra.Item,{title:"No to-dos for today."}),e?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(c.MenuBarExtra.Section,{children:[(0,d.jsx)(c.MenuBarExtra.Item,{...E.inbox,shortcut:{modifiers:["cmd"],key:"i"},onAction:()=>(0,c.open)("things:///show?id=inbox")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.today,shortcut:{modifiers:["cmd"],key:"t"},onAction:()=>(0,c.open)("things:///show?id=today")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.upcoming,shortcut:{modifiers:["cmd"],key:"u"},onAction:()=>(0,c.open)("things:///show?id=upcoming")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.anytime,shortcut:{modifiers:["cmd"],key:"a"},onAction:()=>(0,c.open)("things:///show?id=anytime")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.someday,shortcut:{modifiers:["cmd"],key:"s"},onAction:()=>(0,c.open)("things:///show?id=someday")}),(0,d.jsx)(c.MenuBarExtra.Item,{...E.logbook,shortcut:{modifiers:["cmd"],key:"l"},onAction:()=>(0,c.open)("things:///show?id=logbook")})]}),s&&s.length>0?(0,d.jsxs)(c.MenuBarExtra.Section,{children:[s.slice(0,6).map(u=>(0,d.jsx)(c.MenuBarExtra.Item,{...E.list(u),onAction:()=>(0,c.open)(`things:///show?id=${encodeURIComponent(u.id)}`)},u.id)),s.length>6?(0,d.jsx)(c.MenuBarExtra.Submenu,{title:"More",icon:c.Icon.Ellipsis,children:s.slice(6).map(u=>(0,d.jsx)(c.MenuBarExtra.Item,{...E.list(u),onAction:()=>(0,c.open)(`things:///show?id=${encodeURIComponent(u.id)}`)},u.id))}):null]}):null]}):null,(0,d.jsxs)(c.MenuBarExtra.Section,{children:[(0,d.jsx)(c.MenuBarExtra.Item,{title:"Add New To-Do",icon:c.Icon.Plus,shortcut:{modifiers:["cmd"],key:"n"},onAction:()=>{(0,c.launchCommand)({name:"add-new-todo",type:c.LaunchType.UserInitiated,context:{list:"today"}})}}),(0,d.jsx)(c.MenuBarExtra.Item,{title:"Configure Command",icon:c.Icon.Gear,shortcut:{modifiers:["cmd"],key:","},onAction:c.openCommandPreferences})]})]})}
