"use strict";var re=Object.create;var R=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var oe=(a,s)=>{for(var t in s)R(a,t,{get:s[t],enumerable:!0})},W=(a,s,t,c)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of ae(s))!ie.call(a,o)&&o!==t&&R(a,o,{get:()=>s[o],enumerable:!(c=ne(s,o))||c.enumerable});return a};var ce=(a,s,t)=>(t=a!=null?re(se(a)):{},W(s||!a||!a.__esModule?R(t,"default",{value:a,enumerable:!0}):t,a)),le=a=>W(R({},"__esModule",{value:!0}),a);var pe={};oe(pe,{default:()=>F});module.exports=le(pe);var e=require("@raycast/api");var w=ce(require("react")),f=require("@raycast/api");var N=require("react/jsx-runtime");function z(a,s,t,c){let o=(c-90)*Math.PI/180;return{x:a+t*Math.cos(o),y:s+t*Math.sin(o)}}function ue(a,s,t,c,o){let d=z(a,s,t,o),u=z(a,s,t,c),l=o-c<=180?"0":"1";return["M",d.x,d.y,"A",t,t,0,l,0,u.x,u.y].join(" ")}function V(a,s=f.Color.Red,t){let c=t?.background||(f.environment.appearance==="light"?"black":"white"),o=t?.backgroundOpacity||.1,d=10,l=50-5-d/2,b=`<svg xmlns="http://www.w3.org/2000/svg" width="100px" height="100px">
      <circle cx="50" cy="50" r="${l}" stroke-width="${d}" stroke="${a<1?c:s}" opacity="${a<1?o:"1"}" fill="none" />
      ${a>0&&a<1?`<path d="${ue(50,50,l,0,a*360)}" stroke="${s}" stroke-width="${d}" fill="none" />`:""}
    </svg>
  `.replaceAll(`
`,"");return`data:image/svg+xml,${encodeURIComponent(b)}`}var m=require("react"),i=require("react/jsx-runtime"),O="tldr-cache",fe=10080*60*1e3,E=["common","linux","osx","windows","android","freebsd","netbsd","openbsd","sunos"];async function de(a,s=3){for(let t=0;t<s;t++)try{let c=await fetch(a);if(!c.ok&&t<s-1){let o=Math.min(1e3*Math.pow(2,t),1e4);await new Promise(d=>setTimeout(d,o));continue}return c}catch(c){if(t===s-1)throw c;let o=Math.min(1e3*Math.pow(2,t),1e4);await new Promise(d=>setTimeout(d,o))}throw new Error("Max retries reached")}function F(){let[a,s]=(0,m.useState)(""),[t,c]=(0,m.useState)(!0),[o,d]=(0,m.useState)(0),[u,l]=(0,m.useState)([]),[b,p]=(0,m.useState)([]),[P,j]=(0,m.useState)("all"),L=(0,e.getPreferenceValues)();(0,m.useEffect)(()=>{B()},[]),(0,m.useEffect)(()=>{H()},[a,u,P]);let B=async()=>{try{let r=await e.LocalStorage.getItem(O);if(r){let n=JSON.parse(r);if(Date.now()-n.lastUpdated<fe){l(n.pages),c(!1);return}}await _()}catch(r){console.error("Error loading cache:",r),await _()}},_=async()=>{c(!0),d(0);let r=await(0,e.showToast)({style:e.Toast.Style.Animated,title:"Updating TLDR pages...",message:"Starting..."});try{let n=[],h=L.language||"en",k=E.length;r.message="Fetching file tree...";let $=await de("https://api.github.com/repos/tldr-pages/tldr/git/trees/main?recursive=1");if(!$.ok)throw new Error(`Failed to fetch tree: ${$.statusText}`);let q=await $.json(),U=h==="en"?"pages/":`pages.${h}/`,T={};for(let g of q.tree)if(g.type==="blob"&&g.path.startsWith(U)&&g.path.endsWith(".md")){let x=g.path.substring(U.length).split("/");if(x.length===2){let[v,A]=x;E.includes(v)&&(T[v]||(T[v]=[]),T[v].push(A))}}for(let g=0;g<E.length;g++){let y=E[g],x=T[y]||[];if(x.length===0)continue;let v=g/k;d(v),r.message=`Fetching ${y} (${g+1}/${k})...`;try{for(let C=0;C<x.length;C+=50){let X=x.slice(C,C+50),Q=await Promise.allSettled(X.map(async S=>{let M=S.replace(".md",""),ee=`https://raw.githubusercontent.com/tldr-pages/tldr/main/${U}${y}/${S}`,I=await fetch(ee);if(!I.ok)throw new Error(`Failed to fetch ${M}: ${I.statusText}`);let te=await I.text();return{name:M,platform:y,language:h,content:te}}));for(let S of Q)S.status==="fulfilled"&&n.push(S.value);r.message=`${y}: ${n.length} pages loaded...`}}catch(A){console.error(`Error fetching platform ${y}:`,A)}}let Y={pages:n,lastUpdated:Date.now(),index:G(n)};await e.LocalStorage.setItem(O,JSON.stringify(Y)),l(n),d(1),r.style=e.Toast.Style.Success,r.title=`Updated ${n.length} pages`}catch(n){r.style=e.Toast.Style.Failure,r.title="Failed to update",r.message=String(n)}finally{c(!1)}},G=r=>{let n={};for(let h of r)n[h.name]||(n[h.name]=[]),n[h.name].push(h);return n},H=()=>{let r=u;if(P!=="all"&&(r=r.filter(n=>n.platform===P)),a){let n=a.toLowerCase();r=r.filter(h=>h.name.toLowerCase().includes(n)||h.content.toLowerCase().includes(n))}p(r)},K=async()=>{await e.LocalStorage.removeItem(O),l([]),await(0,e.showToast)({style:e.Toast.Style.Success,title:"Cache cleared"})},Z=b.reduce((r,n)=>(r[n.name]||(r[n.name]=[]),r[n.name].push(n),r),{}),J=u.reduce((r,n)=>(r[n.platform]=(r[n.platform]||0)+1,r),{});return(0,i.jsxs)(e.List,{isLoading:t,searchBarPlaceholder:"Search TLDR pages...",onSearchTextChange:s,throttle:!0,searchBarAccessory:(0,i.jsxs)(e.List.Dropdown,{tooltip:"Filter by Platform",value:P,onChange:j,storeValue:!0,children:[(0,i.jsx)(e.List.Dropdown.Item,{title:"All Platforms",value:"all",icon:e.Icon.Globe}),(0,i.jsx)(e.List.Dropdown.Section,{title:"Platforms",children:E.map(r=>(0,i.jsx)(e.List.Dropdown.Item,{title:`${r} (${J[r]||0})`,value:r,icon:e.Icon.Folder},r))})]}),children:[Object.entries(Z).map(([r,n])=>{let h=L.platform||"common",k=n.find($=>$.platform===h)||n.find($=>$.platform==="common")||n[0],D=t?V(o,e.Color.Blue):void 0;return(0,i.jsx)(e.List.Item,{title:r,subtitle:k.platform,icon:D||{source:e.Icon.Terminal,tintColor:e.Color.Blue},accessories:[{text:n.length>1?`${n.length} platforms`:""}],actions:(0,i.jsxs)(e.ActionPanel,{children:[(0,i.jsx)(e.Action.Push,{title:"View Page",icon:e.Icon.Eye,target:(0,i.jsx)(he,{page:k,allVariants:n})}),(0,i.jsx)(e.Action.CopyToClipboard,{title:"Copy Name",content:r,shortcut:{modifiers:["cmd"],key:"c"}}),(0,i.jsxs)(e.ActionPanel.Section,{children:[(0,i.jsx)(e.Action,{title:"Update Cache",icon:e.Icon.Download,onAction:_,shortcut:{modifiers:["cmd"],key:"r"}}),(0,i.jsx)(e.Action,{title:"Clear Cache",icon:e.Icon.Trash,onAction:K,shortcut:{modifiers:["cmd","shift"],key:"delete"}})]})]})},`${r}-${k.platform}`)}),!t&&b.length===0&&(0,i.jsx)(e.List.EmptyView,{title:"No pages found",description:"Try updating the cache or searching for a different command",icon:e.Icon.MagnifyingGlass})]})}function he({page:a,allVariants:s}){let[t,c]=(0,m.useState)(a),o=u=>{let l=`# ${t.name}

`;l+=`**Platform:** ${t.platform}

`;let b=u.split(`
`).filter(p=>!p.startsWith("#"));for(let p of b)p.startsWith(">")?l+=`${p.substring(1).trim()}

`:p.startsWith("-")?l+=`${p}
`:p.startsWith("`")?l+=`
${p}
`:p.trim()&&(l+=`${p}
`);return l},d=u=>{let l=u.match(/`[^`]+`/g);return l&&l.length>0?l[0].replace(/`/g,"").replace(/\{\{[^}]+\}\}/g,"<placeholder>").replace(/\s+/g," ").trim():""};return(0,i.jsx)(e.Detail,{markdown:o(t.content),actions:(0,i.jsxs)(e.ActionPanel,{children:[(0,i.jsx)(e.Action.CopyToClipboard,{title:"Copy First Example",content:d(t.content)}),(0,i.jsx)(e.Action.CopyToClipboard,{title:"Copy All Content",content:t.content,shortcut:{modifiers:["cmd","shift"],key:"c"}}),s.length>1&&(0,i.jsx)(e.ActionPanel.Submenu,{title:"Switch Platform",icon:e.Icon.ComputerChip,children:s.map(u=>(0,i.jsx)(e.Action,{title:u.platform,onAction:()=>c(u)},u.platform))})]}),metadata:(0,i.jsxs)(e.Detail.Metadata,{children:[(0,i.jsx)(e.Detail.Metadata.Label,{title:"Command",text:t.name}),(0,i.jsx)(e.Detail.Metadata.Label,{title:"Platform",text:t.platform}),(0,i.jsx)(e.Detail.Metadata.Label,{title:"Language",text:t.language}),s.length>1&&(0,i.jsx)(e.Detail.Metadata.TagList,{title:"Available Platforms",children:s.map(u=>(0,i.jsx)(e.Detail.Metadata.TagList.Item,{text:u.platform},u.platform))})]})})}
